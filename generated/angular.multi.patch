From b18f1aaf683e5f5c5b20212b43a4fef97c1c7664 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Wed, 13 May 2015 14:45:15 -0700
Subject: [PATCH 01/37] Step 1: Run `meteor create`

---
 .meteor/.finished-upgraders |  8 ++++++++
 .meteor/.gitignore          |  1 +
 .meteor/.id                 |  7 +++++++
 .meteor/packages            |  9 +++++++++
 .meteor/platforms           |  2 ++
 .meteor/release             |  1 +
 .meteor/versions            | 48 +++++++++++++++++++++++++++++++++++++++++++++
 simple-todos-angular.css    |  1 +
 simple-todos-angular.html   | 14 +++++++++++++
 simple-todos-angular.js     | 23 ++++++++++++++++++++++
 10 files changed, 114 insertions(+)
 create mode 100644 .meteor/.finished-upgraders
 create mode 100644 .meteor/.gitignore
 create mode 100644 .meteor/.id
 create mode 100644 .meteor/packages
 create mode 100644 .meteor/platforms
 create mode 100644 .meteor/release
 create mode 100644 .meteor/versions
 create mode 100644 simple-todos-angular.css
 create mode 100644 simple-todos-angular.html
 create mode 100644 simple-todos-angular.js

diff --git a/.meteor/.finished-upgraders b/.meteor/.finished-upgraders
new file mode 100644
index 0000000..8a76103
--- /dev/null
+++ b/.meteor/.finished-upgraders
@@ -0,0 +1,8 @@
+# This file contains information which helps Meteor properly upgrade your
+# app when you run 'meteor update'. You should check it into version control
+# with your project.
+
+notices-for-0.9.0
+notices-for-0.9.1
+0.9.4-platform-file
+notices-for-facebook-graph-api-2
diff --git a/.meteor/.gitignore b/.meteor/.gitignore
new file mode 100644
index 0000000..4083037
--- /dev/null
+++ b/.meteor/.gitignore
@@ -0,0 +1 @@
+local
diff --git a/.meteor/.id b/.meteor/.id
new file mode 100644
index 0000000..efd78f0
--- /dev/null
+++ b/.meteor/.id
@@ -0,0 +1,7 @@
+# This file contains a token that is unique to your project.
+# Check it into your repository along with the rest of this directory.
+# It can be used for purposes such as:
+#   - ensuring you don't accidentally deploy one app on top of another
+#   - providing package authors with aggregated statistics
+
+1b8dzlr112p5wug6xm9d
diff --git a/.meteor/packages b/.meteor/packages
new file mode 100644
index 0000000..99704e0
--- /dev/null
+++ b/.meteor/packages
@@ -0,0 +1,9 @@
+# Meteor packages used by this project, one per line.
+# Check this file (and the other files in this directory) into your repository.
+#
+# 'meteor add' and 'meteor remove' will edit this file for you,
+# but you can also edit it by hand.
+
+meteor-platform
+autopublish
+insecure
diff --git a/.meteor/platforms b/.meteor/platforms
new file mode 100644
index 0000000..efeba1b
--- /dev/null
+++ b/.meteor/platforms
@@ -0,0 +1,2 @@
+server
+browser
diff --git a/.meteor/release b/.meteor/release
new file mode 100644
index 0000000..dab6b55
--- /dev/null
+++ b/.meteor/release
@@ -0,0 +1 @@
+METEOR@1.1.0.2
diff --git a/.meteor/versions b/.meteor/versions
new file mode 100644
index 0000000..410e1d9
--- /dev/null
+++ b/.meteor/versions
@@ -0,0 +1,48 @@
+autopublish@1.0.3
+autoupdate@1.2.1
+base64@1.0.3
+binary-heap@1.0.3
+blaze@2.1.2
+blaze-tools@1.0.3
+boilerplate-generator@1.0.3
+callback-hook@1.0.3
+check@1.0.5
+ddp@1.1.0
+deps@1.0.7
+ejson@1.0.6
+fastclick@1.0.3
+geojson-utils@1.0.3
+html-tools@1.0.4
+htmljs@1.0.4
+http@1.1.0
+id-map@1.0.3
+insecure@1.0.3
+jquery@1.11.3_2
+json@1.0.3
+launch-screen@1.0.2
+livedata@1.0.13
+logging@1.0.7
+meteor@1.1.6
+meteor-platform@1.2.2
+minifiers@1.1.5
+minimongo@1.0.8
+mobile-status-bar@1.0.3
+mongo@1.1.0
+observe-sequence@1.0.6
+ordered-dict@1.0.3
+random@1.0.3
+reactive-dict@1.1.0
+reactive-var@1.0.5
+reload@1.1.3
+retry@1.0.3
+routepolicy@1.0.5
+session@1.1.0
+spacebars@1.0.6
+spacebars-compiler@1.0.6
+templating@1.1.1
+tracker@1.0.7
+ui@1.0.6
+underscore@1.0.3
+url@1.0.4
+webapp@1.2.0
+webapp-hashing@1.0.3
diff --git a/simple-todos-angular.css b/simple-todos-angular.css
new file mode 100644
index 0000000..b6b4052
--- /dev/null
+++ b/simple-todos-angular.css
@@ -0,0 +1 @@
+/* CSS declarations go here */
diff --git a/simple-todos-angular.html b/simple-todos-angular.html
new file mode 100644
index 0000000..30ca9b0
--- /dev/null
+++ b/simple-todos-angular.html
@@ -0,0 +1,14 @@
+<head>
+  <title>simple-todos-angular</title>
+</head>
+
+<body>
+  <h1>Welcome to Meteor!</h1>
+
+  {{> hello}}
+</body>
+
+<template name="hello">
+  <button>Click Me</button>
+  <p>You've pressed the button {{counter}} times.</p>
+</template>
diff --git a/simple-todos-angular.js b/simple-todos-angular.js
new file mode 100644
index 0000000..4f8c65d
--- /dev/null
+++ b/simple-todos-angular.js
@@ -0,0 +1,23 @@
+if (Meteor.isClient) {
+  // counter starts at 0
+  Session.setDefault('counter', 0);
+
+  Template.hello.helpers({
+    counter: function () {
+      return Session.get('counter');
+    }
+  });
+
+  Template.hello.events({
+    'click button': function () {
+      // increment the counter when button is clicked
+      Session.set('counter', Session.get('counter') + 1);
+    }
+  });
+}
+
+if (Meteor.isServer) {
+  Meteor.startup(function () {
+    // code to run on server at startup
+  });
+}
-- 
2.3.2 (Apple Git-55)


From 3da58d0f1228342c24254b0268ae04156c5009e9 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:34:04 +0300
Subject: [PATCH 02/37] Step 2.1: Add the Angular package

---
 .meteor/packages | 1 +
 .meteor/versions | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 99704e0..fa5ef7a 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -7,3 +7,4 @@
 meteor-platform
 autopublish
 insecure
+urigo:angular
diff --git a/.meteor/versions b/.meteor/versions
index 410e1d9..70b0764 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,4 @@
+angular:angular@1.4.2
 autopublish@1.0.3
 autoupdate@1.2.1
 base64@1.0.3
@@ -7,6 +8,7 @@ blaze-tools@1.0.3
 boilerplate-generator@1.0.3
 callback-hook@1.0.3
 check@1.0.5
+dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
 deps@1.0.7
 ejson@1.0.6
@@ -19,6 +21,7 @@ id-map@1.0.3
 insecure@1.0.3
 jquery@1.11.3_2
 json@1.0.3
+lai:collection-extensions@0.1.4
 launch-screen@1.0.2
 livedata@1.0.13
 logging@1.0.7
@@ -43,6 +46,7 @@ templating@1.1.1
 tracker@1.0.7
 ui@1.0.6
 underscore@1.0.3
+urigo:angular@0.9.2
 url@1.0.4
 webapp@1.2.0
 webapp-hashing@1.0.3
-- 
2.3.2 (Apple Git-55)


From 579e10de48cd091522b880c6280fcfcc3ec81ed5 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:44:07 +0300
Subject: [PATCH 03/37] Step 2.2: Link main file to Angular templates

---
 simple-todos-angular.html | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/simple-todos-angular.html b/simple-todos-angular.html
index 30ca9b0..f1391a5 100644
--- a/simple-todos-angular.html
+++ b/simple-todos-angular.html
@@ -1,14 +1,8 @@
 <head>
-  <title>simple-todos-angular</title>
+  <title>Todo List</title>
 </head>
 
-<body>
-  <h1>Welcome to Meteor!</h1>
-
-  {{> hello}}
+<body ng-app="simple-todos"
+      ng-include="'todos-list.ng.html'"
+      ng-controller="TodosListCtrl">
 </body>
-
-<template name="hello">
-  <button>Click Me</button>
-  <p>You've pressed the button {{counter}} times.</p>
-</template>
-- 
2.3.2 (Apple Git-55)


From 82fd8e01f18fa64faca04535956815e5dc3f4ea3 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:46:44 +0300
Subject: [PATCH 04/37] Step 2.3: Init Angular app and controller

---
 simple-todos-angular.js | 29 +++++++++++------------------
 1 file changed, 11 insertions(+), 18 deletions(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 4f8c65d..fa676f2 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -1,23 +1,16 @@
 if (Meteor.isClient) {
-  // counter starts at 0
-  Session.setDefault('counter', 0);
 
-  Template.hello.helpers({
-    counter: function () {
-      return Session.get('counter');
-    }
-  });
+  // This code only runs on the client
+  angular.module('simple-todos',['angular-meteor']);
 
-  Template.hello.events({
-    'click button': function () {
-      // increment the counter when button is clicked
-      Session.set('counter', Session.get('counter') + 1);
-    }
-  });
-}
+  angular.module('simple-todos').controller('TodosListCtrl', ['$scope',
+    function ($scope) {
+
+      $scope.tasks = [
+        { text: 'This is task 1' },
+        { text: 'This is task 2' },
+        { text: 'This is task 3' }
+      ];
 
-if (Meteor.isServer) {
-  Meteor.startup(function () {
-    // code to run on server at startup
-  });
+  }]);
 }
-- 
2.3.2 (Apple Git-55)


From 7ec04bb81bd70c6926b42f7ee6f9f9995fe45ece Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:48:44 +0300
Subject: [PATCH 05/37] Step 2.4: First Angular template

---
 todos-list.ng.html | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 todos-list.ng.html

diff --git a/todos-list.ng.html b/todos-list.ng.html
new file mode 100644
index 0000000..3dcfae9
--- /dev/null
+++ b/todos-list.ng.html
@@ -0,0 +1,9 @@
+<div class="container">
+  <header>
+    <h1>Todo List</h1>
+  </header>
+
+  <ul ng-repeat="task in tasks">
+    <li>{{task.text}}</li>
+  </ul>
+</div>
-- 
2.3.2 (Apple Git-55)


From f7cce808089dc131114eedd453292b95731690ac Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:50:26 +0300
Subject: [PATCH 06/37] Step 2.5: Add CSS

---
 simple-todos-angular.css | 126 +++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 126 insertions(+)

diff --git a/simple-todos-angular.css b/simple-todos-angular.css
index b6b4052..0bca5d2 100644
--- a/simple-todos-angular.css
+++ b/simple-todos-angular.css
@@ -1 +1,127 @@
 /* CSS declarations go here */
+body {
+  font-family: sans-serif;
+  background-color: #315481;
+  background-image: linear-gradient(to bottom, #315481, #918e82 100%);
+  background-attachment: fixed;
+
+  position: absolute;
+  top: 0;
+  bottom: 0;
+  left: 0;
+  right: 0;
+
+  padding: 0;
+  margin: 0;
+
+  font-size: 14px;
+}
+
+.container {
+  max-width: 600px;
+  margin: 0 auto;
+  min-height: 100%;
+  background: white;
+}
+
+header {
+  background: #d2edf4;
+  background-image: linear-gradient(to bottom, #d0edf5, #e1e5f0 100%);
+  padding: 20px 15px 15px 15px;
+  position: relative;
+}
+
+#login-buttons {
+  display: block;
+}
+
+h1 {
+  font-size: 1.5em;
+  margin: 0;
+  margin-bottom: 10px;
+  display: inline-block;
+  margin-right: 1em;
+}
+
+form {
+  margin-top: 10px;
+  margin-bottom: -10px;
+  position: relative;
+}
+
+.new-task input {
+  box-sizing: border-box;
+  padding: 10px 0;
+  background: transparent;
+  border: none;
+  width: 100%;
+  padding-right: 80px;
+  font-size: 1em;
+}
+
+.new-task input:focus{
+  outline: 0;
+}
+
+ul {
+  margin: 0;
+  padding: 0;
+  background: white;
+}
+
+.delete {
+  float: right;
+  font-weight: bold;
+  background: none;
+  font-size: 1em;
+  border: none;
+  position: relative;
+}
+
+li {
+  position: relative;
+  list-style: none;
+  padding: 15px;
+  border-bottom: #eee solid 1px;
+}
+
+li .text {
+  margin-left: 10px;
+}
+
+li.checked {
+  color: #888;
+}
+
+li.checked .text {
+  text-decoration: line-through;
+}
+
+li.private {
+  background: #eee;
+  border-color: #ddd;
+}
+
+header .hide-completed {
+  float: right;
+}
+
+.toggle-private {
+  margin-left: 5px;
+}
+
+@media (max-width: 600px) {
+  li {
+    padding: 12px 15px;
+  }
+
+  .search {
+    width: 150px;
+    clear: both;
+  }
+
+  .new-task input {
+    padding-bottom: 5px;
+  }
+}
+
-- 
2.3.2 (Apple Git-55)


From 5589cc40e89bf8ae25a31e69ed86c9c7ebf0073a Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:56:31 +0300
Subject: [PATCH 07/37] Step 3.1: Replace the static array with a Collection

---
 simple-todos-angular.js | 14 ++++++--------
 1 file changed, 6 insertions(+), 8 deletions(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index fa676f2..9a9b236 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -1,16 +1,14 @@
+Tasks = new Mongo.Collection('tasks');
+
 if (Meteor.isClient) {
 
   // This code only runs on the client
   angular.module('simple-todos',['angular-meteor']);
 
-  angular.module('simple-todos').controller('TodosListCtrl', ['$scope',
-    function ($scope) {
+  angular.module('simple-todos').controller('TodosListCtrl', ['$scope', '$meteor',
+    function ($scope, $meteor) {
 
-      $scope.tasks = [
-        { text: 'This is task 1' },
-        { text: 'This is task 2' },
-        { text: 'This is task 3' }
-      ];
+      $scope.tasks = $meteor.collection(Tasks);
 
-  }]);
+    }]);
 }
-- 
2.3.2 (Apple Git-55)


From ab09bcf16256968772baf78d792ee3802230a615 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 12:58:59 +0300
Subject: [PATCH 08/37] Step 4.1: Add new task form to template

---
 todos-list.ng.html | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index 3dcfae9..6b6e0e0 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -1,6 +1,12 @@
 <div class="container">
   <header>
     <h1>Todo List</h1>
+
+    <!-- add a form below the h1 -->
+    <form class="new-task" ng-submit="addTask(newTask); newTask='';">
+      <input ng-model="newTask" type="text"
+             name="text" placeholder="Type to add new tasks" />
+    </form>
   </header>
 
   <ul ng-repeat="task in tasks">
-- 
2.3.2 (Apple Git-55)


From 3ba891e95d2ebb77e99acb525b79506fc516a1cb Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:00:30 +0300
Subject: [PATCH 09/37] Step 4.2: Create Add Task scope function

---
 simple-todos-angular.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 9a9b236..e9dc878 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -10,5 +10,12 @@ if (Meteor.isClient) {
 
       $scope.tasks = $meteor.collection(Tasks);
 
+      $scope.addTask = function (newTask) {
+        $scope.tasks.push( {
+          text: newTask,
+          createdAt: new Date() }
+        );
+      };
+
     }]);
 }
-- 
2.3.2 (Apple Git-55)


From 7d3a03a08b48b1a1f0ac492d7f6685206b459d36 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:01:36 +0300
Subject: [PATCH 10/37] Step 4.3: Sort task list by date

---
 simple-todos-angular.js | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index e9dc878..36ab6d1 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -8,7 +8,9 @@ if (Meteor.isClient) {
   angular.module('simple-todos').controller('TodosListCtrl', ['$scope', '$meteor',
     function ($scope, $meteor) {
 
-      $scope.tasks = $meteor.collection(Tasks);
+      $scope.tasks = $meteor.collection( function() {
+        return Tasks.find({}, { sort: { createdAt: -1 } })
+      });
 
       $scope.addTask = function (newTask) {
         $scope.tasks.push( {
-- 
2.3.2 (Apple Git-55)


From ade01c58b021c1fc432b323bbeaa78ab9f72b941 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:04:21 +0300
Subject: [PATCH 11/37] Step 5.1: Add done and delete buttons to task

---
 todos-list.ng.html | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index 6b6e0e0..bda3dba 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -10,6 +10,12 @@
   </header>
 
   <ul ng-repeat="task in tasks">
-    <li>{{task.text}}</li>
+    <li ng-class="{'checked': task.checked}">
+      <button class="delete" ng-click="tasks.remove(task)">&times;</button>
+
+      <input type="checkbox" ng-model="task.checked" class="toggle-checked" />
+
+      <span class="text">{{task.text}}</span>
+    </li>
   </ul>
 </div>
-- 
2.3.2 (Apple Git-55)


From 8466c1cdf7f7afc7f2f93dce2fa4d514c59f7130 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:08:33 +0300
Subject: [PATCH 12/37] Step 7.1: Remove ng-app

---
 simple-todos-angular.html | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/simple-todos-angular.html b/simple-todos-angular.html
index f1391a5..e43eceb 100644
--- a/simple-todos-angular.html
+++ b/simple-todos-angular.html
@@ -2,7 +2,6 @@
   <title>Todo List</title>
 </head>
 
-<body ng-app="simple-todos"
-      ng-include="'todos-list.ng.html'"
+<body ng-include="'todos-list.ng.html'"
       ng-controller="TodosListCtrl">
 </body>
-- 
2.3.2 (Apple Git-55)


From 85e80627bfb80b13c21367c5f77cdcfdf5fadbd0 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:11:07 +0300
Subject: [PATCH 13/37] Step 7.2: Bootstrap Angular to mobile as well

---
 simple-todos-angular.js | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 36ab6d1..b002918 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -5,6 +5,15 @@ if (Meteor.isClient) {
   // This code only runs on the client
   angular.module('simple-todos',['angular-meteor']);
 
+  function onReady() {
+    angular.bootstrap(document, ['simple-todos']);
+  }
+
+  if (Meteor.isCordova)
+    angular.element(document).on('deviceready', onReady);
+  else
+    angular.element(document).ready(onReady);
+
   angular.module('simple-todos').controller('TodosListCtrl', ['$scope', '$meteor',
     function ($scope, $meteor) {
 
-- 
2.3.2 (Apple Git-55)


From 9b12d06c6242558c1077ad60ab07aefcecd3814f Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:13:14 +0300
Subject: [PATCH 14/37] Step 8.1: Add hideComplete checkbox to template

---
 todos-list.ng.html | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index bda3dba..1049e4a 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -2,6 +2,11 @@
   <header>
     <h1>Todo List</h1>
 
+    <label class="hide-completed">
+      <input type="checkbox" ng-model="$parent.hideCompleted"/>
+      Hide Completed Tasks
+    </label>
+
     <!-- add a form below the h1 -->
     <form class="new-task" ng-submit="addTask(newTask); newTask='';">
       <input ng-model="newTask" type="text"
-- 
2.3.2 (Apple Git-55)


From 919560a990de2a2a370aea6f9e28888f09bd1b6f Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:14:54 +0300
Subject: [PATCH 15/37] Step 8.2: Watch hideCompleted and change the query
 variable

---
 simple-todos-angular.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index b002918..e759172 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -28,5 +28,12 @@ if (Meteor.isClient) {
         );
       };
 
+      $scope.$watch('hideCompleted', function() {
+        if ($scope.hideCompleted)
+          $scope.query = {checked: {$ne: true}};
+        else
+          $scope.query = {};
+      });
+
     }]);
 }
-- 
2.3.2 (Apple Git-55)


From 5adc4b31da9476a898df3db649a4aa7418b0b7d7 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:17:07 +0300
Subject: [PATCH 16/37] Step 8.3: Change the Collection to use query parameter

---
 simple-todos-angular.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index e759172..071be1f 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -17,8 +17,8 @@ if (Meteor.isClient) {
   angular.module('simple-todos').controller('TodosListCtrl', ['$scope', '$meteor',
     function ($scope, $meteor) {
 
-      $scope.tasks = $meteor.collection( function() {
-        return Tasks.find({}, { sort: { createdAt: -1 } })
+      $scope.tasks = $meteor.collection(function() {
+        return Tasks.find($scope.query, {sort: {createdAt: -1}})
       });
 
       $scope.addTask = function (newTask) {
-- 
2.3.2 (Apple Git-55)


From ea6ca654274d1e5a22ec76a2a33c32c388c4ce75 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:17:59 +0300
Subject: [PATCH 17/37] Step 8.4: Make query parameter reactive

---
 simple-todos-angular.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 071be1f..24c55fa 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -18,7 +18,7 @@ if (Meteor.isClient) {
     function ($scope, $meteor) {
 
       $scope.tasks = $meteor.collection(function() {
-        return Tasks.find($scope.query, {sort: {createdAt: -1}})
+        return Tasks.find($scope.getReactively('query'), {sort: {createdAt: -1}})
       });
 
       $scope.addTask = function (newTask) {
-- 
2.3.2 (Apple Git-55)


From f0fb1566f2dfdcd206ec6efe2e274090a1c4a5a8 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:19:38 +0300
Subject: [PATCH 18/37] Step 8.5: Add incompleteCount to scope

---
 simple-todos-angular.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 24c55fa..5934036 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -35,5 +35,9 @@ if (Meteor.isClient) {
           $scope.query = {};
       });
 
+      $scope.incompleteCount = function () {
+        return Tasks.find({ checked: {$ne: true} }).count();
+      };
+
     }]);
 }
-- 
2.3.2 (Apple Git-55)


From 3d4d598cac0c28b9c527545b36b3d7376a8c104c Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:21:13 +0300
Subject: [PATCH 19/37] Step 8.6: Add incompleteCount to header

---
 todos-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index 1049e4a..de9a630 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -1,6 +1,6 @@
 <div class="container">
   <header>
-    <h1>Todo List</h1>
+    <h1>Todo List ( {{ incompleteCount() }} )</h1>
 
     <label class="hide-completed">
       <input type="checkbox" ng-model="$parent.hideCompleted"/>
-- 
2.3.2 (Apple Git-55)


From 452eb1f509886d58662fee94da75dffaeab9abc5 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:22:29 +0300
Subject: [PATCH 20/37] Step 9.1: Add accounts-ui and accounts-password
 packages

---
 .meteor/packages |  2 ++
 .meteor/versions | 11 +++++++++++
 2 files changed, 13 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index fa5ef7a..703dc2c 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -8,3 +8,5 @@ meteor-platform
 autopublish
 insecure
 urigo:angular
+accounts-ui
+accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 70b0764..de04912 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,7 @@
+accounts-base@1.2.0
+accounts-password@1.1.1
+accounts-ui@1.1.5
+accounts-ui-unstyled@1.1.7
 angular:angular@1.4.2
 autopublish@1.0.3
 autoupdate@1.2.1
@@ -12,6 +16,7 @@ dburles:mongo-collection-instances@0.3.4
 ddp@1.1.0
 deps@1.0.7
 ejson@1.0.6
+email@1.0.6
 fastclick@1.0.3
 geojson-utils@1.0.3
 html-tools@1.0.4
@@ -23,7 +28,9 @@ jquery@1.11.3_2
 json@1.0.3
 lai:collection-extensions@0.1.4
 launch-screen@1.0.2
+less@1.0.14
 livedata@1.0.13
+localstorage@1.0.3
 logging@1.0.7
 meteor@1.1.6
 meteor-platform@1.2.2
@@ -31,6 +38,7 @@ minifiers@1.1.5
 minimongo@1.0.8
 mobile-status-bar@1.0.3
 mongo@1.1.0
+npm-bcrypt@0.7.8_2
 observe-sequence@1.0.6
 ordered-dict@1.0.3
 random@1.0.3
@@ -39,9 +47,12 @@ reactive-var@1.0.5
 reload@1.1.3
 retry@1.0.3
 routepolicy@1.0.5
+service-configuration@1.0.4
 session@1.1.0
+sha@1.0.3
 spacebars@1.0.6
 spacebars-compiler@1.0.6
+srp@1.0.3
 templating@1.1.1
 tracker@1.0.7
 ui@1.0.6
-- 
2.3.2 (Apple Git-55)


From 35a313074e5780255f2c3010163a2dec2411afac Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:24:29 +0300
Subject: [PATCH 21/37] Step 9.2: Add Blaze loginButtons template to HTML

---
 todos-list.ng.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index de9a630..e4c0123 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -7,6 +7,8 @@
       Hide Completed Tasks
     </label>
 
+    <meteor-include src="loginButtons"></meteor-include>
+
     <!-- add a form below the h1 -->
     <form class="new-task" ng-submit="addTask(newTask); newTask='';">
       <input ng-model="newTask" type="text"
-- 
2.3.2 (Apple Git-55)


From 253abff3918109b97f642067ec222cf529b09c6c Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:27:12 +0300
Subject: [PATCH 22/37] Step 9.3: Configure accounts UI to use usernames
 instead of email

---
 simple-todos-angular.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 5934036..0c2d6c1 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -2,6 +2,10 @@ Tasks = new Mongo.Collection('tasks');
 
 if (Meteor.isClient) {
 
+  Accounts.ui.config({
+    passwordSignupFields: "USERNAME_ONLY"
+  });
+
   // This code only runs on the client
   angular.module('simple-todos',['angular-meteor']);
 
-- 
2.3.2 (Apple Git-55)


From 8210ff2c37a8b9ccb6b9750aa9d0df94f4e59a8a Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:29:48 +0300
Subject: [PATCH 23/37] Step 9.4: Add owner and username to created task

---
 simple-todos-angular.js | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 0c2d6c1..d0b3829 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -25,10 +25,12 @@ if (Meteor.isClient) {
         return Tasks.find($scope.getReactively('query'), {sort: {createdAt: -1}})
       });
 
-      $scope.addTask = function (newTask) {
+      $scope.addTask = function(newTask) {
         $scope.tasks.push( {
-          text: newTask,
-          createdAt: new Date() }
+            text: newTask,
+            createdAt: new Date(),             // current time
+            owner: Meteor.userId(),            // _id of logged in user
+            username: Meteor.user().username }  // username of logged in user
         );
       };
 
-- 
2.3.2 (Apple Git-55)


From 78d5f5619d9434035d6451ea4077dfcc8edb54ef Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:31:13 +0300
Subject: [PATCH 24/37] Step 9.5: Hide new task form if user is not logged in

---
 todos-list.ng.html | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index e4c0123..aa02851 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -10,7 +10,9 @@
     <meteor-include src="loginButtons"></meteor-include>
 
     <!-- add a form below the h1 -->
-    <form class="new-task" ng-submit="addTask(newTask); newTask='';">
+    <form class="new-task"
+          ng-submit="addTask(newTask); newTask='';"
+          ng-show="$root.currentUser">
       <input ng-model="newTask" type="text"
              name="text" placeholder="Type to add new tasks" />
     </form>
-- 
2.3.2 (Apple Git-55)


From 5b026977269006ac5ebfda7ceb25923fc4d69ab4 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:32:49 +0300
Subject: [PATCH 25/37] Step 9.6: Add username to the displayed task

---
 todos-list.ng.html | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index aa02851..ddc4777 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -24,7 +24,9 @@
 
       <input type="checkbox" ng-model="task.checked" class="toggle-checked" />
 
-      <span class="text">{{task.text}}</span>
+      <span class="text">
+        <strong>{{task.username}}</strong> - {{task.text}}
+      </span>
     </li>
   </ul>
 </div>
-- 
2.3.2 (Apple Git-55)


From a01d86230123f4a46623ddf18775a41ca857e147 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 13:34:54 +0300
Subject: [PATCH 26/37] Step 10.1: Remove the insecure package

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 703dc2c..8798f9d 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -6,7 +6,6 @@
 
 meteor-platform
 autopublish
-insecure
 urigo:angular
 accounts-ui
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index de04912..38fa8cb 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -23,7 +23,6 @@ html-tools@1.0.4
 htmljs@1.0.4
 http@1.1.0
 id-map@1.0.3
-insecure@1.0.3
 jquery@1.11.3_2
 json@1.0.3
 lai:collection-extensions@0.1.4
-- 
2.3.2 (Apple Git-55)


From 3adde199e75d84eae82cf51c48f94f8b3ac607f6 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:02:50 +0300
Subject: [PATCH 27/37] Step 10.2: Add Meteor Methods for add, delete and check
 tasks

---
 simple-todos-angular.js | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index d0b3829..4b12a5e 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -47,3 +47,25 @@ if (Meteor.isClient) {
 
     }]);
 }
+
+Meteor.methods({
+  addTask: function (text) {
+    // Make sure the user is logged in before inserting a task
+    if (! Meteor.userId()) {
+      throw new Meteor.Error('not-authorized');
+    }
+
+    Tasks.insert({
+      text: text,
+      createdAt: new Date(),
+      owner: Meteor.userId(),
+      username: Meteor.user().username
+    });
+  },
+  deleteTask: function (taskId) {
+    Tasks.remove(taskId);
+  },
+  setChecked: function (taskId, setChecked) {
+    Tasks.update(taskId, { $set: { checked: setChecked} });
+  }
+});
-- 
2.3.2 (Apple Git-55)


From e6e0a9eff07668f5189c9e51b4162eacb858a02d Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:05:25 +0300
Subject: [PATCH 28/37] Step 10.3: Add scope functions to call the Meteor
 methods

---
 simple-todos-angular.js | 17 ++++++++++-------
 1 file changed, 10 insertions(+), 7 deletions(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 4b12a5e..655fe79 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -25,13 +25,16 @@ if (Meteor.isClient) {
         return Tasks.find($scope.getReactively('query'), {sort: {createdAt: -1}})
       });
 
-      $scope.addTask = function(newTask) {
-        $scope.tasks.push( {
-            text: newTask,
-            createdAt: new Date(),             // current time
-            owner: Meteor.userId(),            // _id of logged in user
-            username: Meteor.user().username }  // username of logged in user
-        );
+      $scope.addTask = function (newTask) {
+        $meteor.call('addTask', newTask);
+      };
+
+      $scope.deleteTask = function (task) {
+        $meteor.call('deleteTask', task._id);
+      };
+
+      $scope.setChecked = function (task) {
+        $meteor.call('setChecked', task._id, !task.checked);
       };
 
       $scope.$watch('hideCompleted', function() {
-- 
2.3.2 (Apple Git-55)


From 33215ecc0a0da5b8aedac04d5ae57f84770b9906 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:08:04 +0300
Subject: [PATCH 29/37] Step 10.4: Change template events to call methods

---
 todos-list.ng.html | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index ddc4777..ab2270f 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -20,9 +20,10 @@
 
   <ul ng-repeat="task in tasks">
     <li ng-class="{'checked': task.checked}">
-      <button class="delete" ng-click="tasks.remove(task)">&times;</button>
+      <button class="delete" ng-click="deleteTask(task)">&times;</button>
 
-      <input type="checkbox" ng-model="task.checked" class="toggle-checked" />
+      <input type="checkbox" ng-checked="task.checked"
+             ng-click="setChecked(task)" class="toggle-checked" />
 
       <span class="text">
         <strong>{{task.username}}</strong> - {{task.text}}
-- 
2.3.2 (Apple Git-55)


From d14c3f1c5d1e6aebc8daec8b406c9021bbb7afe8 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:09:23 +0300
Subject: [PATCH 30/37] Step 11.1: Remove the autopublish package

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 8798f9d..2d0433a 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -5,7 +5,6 @@
 # but you can also edit it by hand.
 
 meteor-platform
-autopublish
 urigo:angular
 accounts-ui
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 38fa8cb..96bf8b7 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -3,7 +3,6 @@ accounts-password@1.1.1
 accounts-ui@1.1.5
 accounts-ui-unstyled@1.1.7
 angular:angular@1.4.2
-autopublish@1.0.3
 autoupdate@1.2.1
 base64@1.0.3
 binary-heap@1.0.3
-- 
2.3.2 (Apple Git-55)


From e9afaa4006a2ffcb0b580a6d09b4d1a081fe12dc Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:10:25 +0300
Subject: [PATCH 31/37] Step 11.2: Add server publish function to tasks

---
 simple-todos-angular.js | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 655fe79..439a148 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -72,3 +72,9 @@ Meteor.methods({
     Tasks.update(taskId, { $set: { checked: setChecked} });
   }
 });
+
+if (Meteor.isServer) {
+  Meteor.publish('tasks', function () {
+    return Tasks.find();
+  });
+}
-- 
2.3.2 (Apple Git-55)


From e35c7c06c99042e26219976379ff75eef93876a7 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:11:21 +0300
Subject: [PATCH 32/37] Step 11.3: Subscribe to tasks publication

---
 simple-todos-angular.js | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 439a148..6464ff3 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -21,6 +21,8 @@ if (Meteor.isClient) {
   angular.module('simple-todos').controller('TodosListCtrl', ['$scope', '$meteor',
     function ($scope, $meteor) {
 
+      $scope.$meteorSubscribe('tasks');
+
       $scope.tasks = $meteor.collection(function() {
         return Tasks.find($scope.getReactively('query'), {sort: {createdAt: -1}})
       });
-- 
2.3.2 (Apple Git-55)


From 52d3d8eff291d72e9d320a5048d05a8ba9b26e01 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:53:12 +0300
Subject: [PATCH 33/37] Step 11.4: Add setPrivate button to template

---
 todos-list.ng.html | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index ab2270f..61435a2 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -25,6 +25,12 @@
       <input type="checkbox" ng-checked="task.checked"
              ng-click="setChecked(task)" class="toggle-checked" />
 
+      <button class="toggle-private"
+              ng-if="task.owner === $root.currentUser._id"
+              ng-click="setPrivate(task)">
+        {{task.private == true ? "Private" : "Public"}}
+      </button>
+
       <span class="text">
         <strong>{{task.username}}</strong> - {{task.text}}
       </span>
-- 
2.3.2 (Apple Git-55)


From 953c93f072e41324937a7183015579ed4899c90c Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:54:33 +0300
Subject: [PATCH 34/37] Step 11.5: Add private CSS class to task

---
 todos-list.ng.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/todos-list.ng.html b/todos-list.ng.html
index 61435a2..1799364 100644
--- a/todos-list.ng.html
+++ b/todos-list.ng.html
@@ -19,7 +19,7 @@
   </header>
 
   <ul ng-repeat="task in tasks">
-    <li ng-class="{'checked': task.checked}">
+    <li ng-class="{'checked': task.checked, 'private': task.private}">
       <button class="delete" ng-click="deleteTask(task)">&times;</button>
 
       <input type="checkbox" ng-checked="task.checked"
-- 
2.3.2 (Apple Git-55)


From 92a93e3b861d94aa9bcc65dc510e803f6029dd65 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:56:20 +0300
Subject: [PATCH 35/37] Step 11.6: Add setPrivate method

---
 simple-todos-angular.js | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index 6464ff3..bdc75a8 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -39,6 +39,10 @@ if (Meteor.isClient) {
         $meteor.call('setChecked', task._id, !task.checked);
       };
 
+      $scope.setPrivate = function (task) {
+        $meteor.call('setPrivate', task._id, ! task.private);
+      };
+
       $scope.$watch('hideCompleted', function() {
         if ($scope.hideCompleted)
           $scope.query = {checked: {$ne: true}};
@@ -72,6 +76,16 @@ Meteor.methods({
   },
   setChecked: function (taskId, setChecked) {
     Tasks.update(taskId, { $set: { checked: setChecked} });
+  },
+  setPrivate: function (taskId, setToPrivate) {
+    var task = Tasks.findOne(taskId);
+
+    // Make sure only the task owner can make a task private
+    if (task.owner !== Meteor.userId()) {
+      throw new Meteor.Error('not-authorized');
+    }
+
+    Tasks.update(taskId, { $set: { private: setToPrivate } });
   }
 });
 
-- 
2.3.2 (Apple Git-55)


From f215e80f518c6d0aea213d6e230dc6521a028e2f Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 15:59:53 +0300
Subject: [PATCH 36/37] Step 11.7: Publish only public and owner's tasks

---
 simple-todos-angular.js | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index bdc75a8..a6089ab 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -91,6 +91,11 @@ Meteor.methods({
 
 if (Meteor.isServer) {
   Meteor.publish('tasks', function () {
-    return Tasks.find();
+    return Tasks.find({
+      $or: [
+        { private: {$ne: true} },
+        { owner: this.userId }
+      ]
+    });
   });
 }
-- 
2.3.2 (Apple Git-55)


From da7a9772ff9d58545765dc9eb370508f25a06956 Mon Sep 17 00:00:00 2001
From: Uri Goldshtein <uri.goldshtein@gmail.com>
Date: Sat, 18 Jul 2015 16:02:20 +0300
Subject: [PATCH 37/37] Step 11.8: Add extra security to methods

---
 simple-todos-angular.js | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/simple-todos-angular.js b/simple-todos-angular.js
index a6089ab..1d371fb 100644
--- a/simple-todos-angular.js
+++ b/simple-todos-angular.js
@@ -72,9 +72,21 @@ Meteor.methods({
     });
   },
   deleteTask: function (taskId) {
+    var task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can delete it
+      throw new Meteor.Error('not-authorized');
+    }
+
     Tasks.remove(taskId);
   },
   setChecked: function (taskId, setChecked) {
+    var task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can check it off
+      throw new Meteor.Error('not-authorized');
+    }
+
     Tasks.update(taskId, { $set: { checked: setChecked} });
   },
   setPrivate: function (taskId, setToPrivate) {
-- 
2.3.2 (Apple Git-55)

