From 6d14a8cd5ec233ea6714dce2a5e92560438dcf3c Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:10:43 -0700
Subject: [PATCH 1/9] Step 1: Run `meteor create`

---
 .meteor/.finished-upgraders |  7 +++++++
 .meteor/.gitignore          |  1 +
 .meteor/.id                 |  7 +++++++
 .meteor/packages            |  8 +++++++
 .meteor/platforms           |  2 ++
 .meteor/release             |  1 +
 .meteor/versions            | 51 +++++++++++++++++++++++++++++++++++++++++++++
 simple-todos.css            |  1 +
 simple-todos.html           | 14 +++++++++++++
 simple-todos.js             | 23 ++++++++++++++++++++
 10 files changed, 115 insertions(+)
 create mode 100644 .meteor/.finished-upgraders
 create mode 100644 .meteor/.gitignore
 create mode 100644 .meteor/.id
 create mode 100644 .meteor/packages
 create mode 100644 .meteor/platforms
 create mode 100644 .meteor/release
 create mode 100644 .meteor/versions
 create mode 100644 simple-todos.css
 create mode 100644 simple-todos.html
 create mode 100644 simple-todos.js

diff --git a/.meteor/.finished-upgraders b/.meteor/.finished-upgraders
new file mode 100644
index 0000000..68df3d8
--- /dev/null
+++ b/.meteor/.finished-upgraders
@@ -0,0 +1,7 @@
+# This file contains information which helps Meteor properly upgrade your
+# app when you run 'meteor update'. You should check it into version control
+# with your project.
+
+notices-for-0.9.0
+notices-for-0.9.1
+0.9.4-platform-file
diff --git a/.meteor/.gitignore b/.meteor/.gitignore
new file mode 100644
index 0000000..4083037
--- /dev/null
+++ b/.meteor/.gitignore
@@ -0,0 +1 @@
+local
diff --git a/.meteor/.id b/.meteor/.id
new file mode 100644
index 0000000..4083db2
--- /dev/null
+++ b/.meteor/.id
@@ -0,0 +1,7 @@
+# This file contains a token that is unique to your project.
+# Check it into your repository along with the rest of this directory.
+# It can be used for purposes such as:
+#   - ensuring you don't accidentally deploy one app on top of another
+#   - providing package authors with aggregated statistics
+
+1i530y1aqmxpd1pq5mnl
diff --git a/.meteor/packages b/.meteor/packages
new file mode 100644
index 0000000..e893668
--- /dev/null
+++ b/.meteor/packages
@@ -0,0 +1,8 @@
+# Meteor packages used by this project, one per line.
+#
+# 'meteor add' and 'meteor remove' will edit this file for you,
+# but you can also edit it by hand.
+
+meteor-platform
+autopublish
+insecure
diff --git a/.meteor/platforms b/.meteor/platforms
new file mode 100644
index 0000000..efeba1b
--- /dev/null
+++ b/.meteor/platforms
@@ -0,0 +1,2 @@
+server
+browser
diff --git a/.meteor/release b/.meteor/release
new file mode 100644
index 0000000..7057f80
--- /dev/null
+++ b/.meteor/release
@@ -0,0 +1 @@
+METEOR@0.9.4
diff --git a/.meteor/versions b/.meteor/versions
new file mode 100644
index 0000000..8f169db
--- /dev/null
+++ b/.meteor/versions
@@ -0,0 +1,51 @@
+application-configuration@1.0.3
+autopublish@1.0.1
+autoupdate@1.1.2
+base64@1.0.1
+binary-heap@1.0.1
+blaze-tools@1.0.1
+blaze@2.0.2
+boilerplate-generator@1.0.1
+callback-hook@1.0.1
+check@1.0.2
+ctl-helper@1.0.4
+ctl@1.0.2
+ddp@1.0.10
+deps@1.0.5
+ejson@1.0.4
+fastclick@1.0.1
+follower-livedata@1.0.2
+geojson-utils@1.0.1
+html-tools@1.0.2
+htmljs@1.0.2
+http@1.0.7
+id-map@1.0.1
+insecure@1.0.1
+jquery@1.0.1
+json@1.0.1
+livedata@1.0.11
+logging@1.0.4
+meteor-platform@1.1.2
+meteor@1.1.2
+minifiers@1.1.1
+minimongo@1.0.4
+mobile-status-bar@1.0.1
+mongo@1.0.7
+observe-sequence@1.0.3
+ordered-dict@1.0.1
+random@1.0.1
+reactive-dict@1.0.4
+reactive-var@1.0.3
+reload@1.1.1
+retry@1.0.1
+routepolicy@1.0.2
+session@1.0.3
+spacebars-compiler@1.0.3
+spacebars@1.0.3
+templating@1.0.8
+tracker@1.0.3
+ui@1.0.4
+underscore@1.0.1
+url@1.0.1
+webapp-hashing@1.0.1
+webapp@1.1.3
diff --git a/simple-todos.css b/simple-todos.css
new file mode 100644
index 0000000..b6b4052
--- /dev/null
+++ b/simple-todos.css
@@ -0,0 +1 @@
+/* CSS declarations go here */
diff --git a/simple-todos.html b/simple-todos.html
new file mode 100644
index 0000000..b08c7c3
--- /dev/null
+++ b/simple-todos.html
@@ -0,0 +1,14 @@
+<head>
+  <title>simple-todos</title>
+</head>
+
+<body>
+  <h1>Welcome to Meteor!</h1>
+
+  {{> hello}}
+</body>
+
+<template name="hello">
+  <button>Click Me</button>
+  <p>You've pressed the button {{counter}} times.</p>
+</template>
diff --git a/simple-todos.js b/simple-todos.js
new file mode 100644
index 0000000..f8bee6b
--- /dev/null
+++ b/simple-todos.js
@@ -0,0 +1,23 @@
+if (Meteor.isClient) {
+  // counter starts at 0
+  Session.setDefault("counter", 0);
+
+  Template.hello.helpers({
+    counter: function () {
+      return Session.get("counter");
+    }
+  });
+
+  Template.hello.events({
+    'click button': function () {
+      // increment the counter when button is clicked
+      Session.set("counter", Session.get("counter") + 1);
+    }
+  });
+}
+
+if (Meteor.isServer) {
+  Meteor.startup(function () {
+    // code to run on server at startup
+  });
+}
-- 
2.2.1


From e998be2ddf735d361f560b8d8bf9631b1151fee7 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:11:55 -0700
Subject: [PATCH 2/9] Step 2: Add templates backed by a static array and all of
 the CSS

---
 simple-todos.css  | 125 ++++++++++++++++++++++++++++++++++++++++++++++++++++++
 simple-todos.html |  19 ++++++---
 simple-todos.js   |  27 +++---------
 3 files changed, 145 insertions(+), 26 deletions(-)

diff --git a/simple-todos.css b/simple-todos.css
index b6b4052..cec3ae6 100644
--- a/simple-todos.css
+++ b/simple-todos.css
@@ -1 +1,126 @@
 /* CSS declarations go here */
+body {
+  font-family: sans-serif;
+  background-color: #315481;
+  background-image: linear-gradient(to bottom, #315481, #918e82 100%);
+  background-attachment: fixed;
+
+  position: absolute;
+  top: 0;
+  bottom: 0;
+  left: 0;
+  right: 0;
+
+  padding: 0;
+  margin: 0;
+
+  font-size: 14px;
+}
+
+.container {
+  max-width: 600px;
+  margin: 0 auto;
+  min-height: 100%;
+  background: white;
+}
+
+header {
+  background: #d2edf4;
+  background-image: linear-gradient(to bottom, #d0edf5, #e1e5f0 100%);
+  padding: 20px 15px 15px 15px;
+  position: relative;
+}
+
+#login-buttons {
+  display: block;
+}
+
+h1 {
+  font-size: 1.5em;
+  margin: 0;
+  margin-bottom: 10px;
+  display: inline-block;
+  margin-right: 1em;
+}
+
+form {
+  margin-top: 10px;
+  margin-bottom: -10px;
+  position: relative;
+}
+
+.new-task input {
+  box-sizing: border-box;
+  padding: 10px 0;
+  background: transparent;
+  border: none;
+  width: 100%;
+  padding-right: 80px;
+  font-size: 1em;
+}
+
+.new-task input:focus{
+  outline: 0;
+}
+
+ul {
+  margin: 0;
+  padding: 0;
+  background: white;
+}
+
+.delete {
+  float: right;
+  font-weight: bold;
+  background: none;
+  font-size: 1em;
+  border: none;
+  position: relative;
+}
+
+li {
+  position: relative;
+  list-style: none;
+  padding: 15px;
+  border-bottom: #eee solid 1px;
+}
+
+li .text {
+  margin-left: 10px;
+}
+
+li.checked {
+  color: #888;
+}
+
+li.checked .text {
+  text-decoration: line-through;
+}
+
+li.private {
+  background: #eee;
+  border-color: #ddd;
+}
+
+header .hide-completed {
+  float: right;
+}
+
+.toggle-private {
+  margin-left: 5px;
+}
+
+@media (max-width: 600px) {
+  li {
+    padding: 12px 15px;
+  }
+
+  .search {
+    width: 150px;
+    clear: both;
+  }
+
+  .new-task input {
+    padding-bottom: 5px;
+  }
+}
\ No newline at end of file
diff --git a/simple-todos.html b/simple-todos.html
index b08c7c3..95624e7 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -1,14 +1,21 @@
 <head>
-  <title>simple-todos</title>
+  <title>Todo List</title>
 </head>
 
 <body>
-  <h1>Welcome to Meteor!</h1>
+  <div class="container">
+    <header>
+      <h1>Todo List</h1>
+    </header>
 
-  {{> hello}}
+    <ul>
+      {{#each tasks}}
+        {{> task}}
+      {{/each}}
+    </ul>
+  </div>
 </body>
 
-<template name="hello">
-  <button>Click Me</button>
-  <p>You've pressed the button {{counter}} times.</p>
+<template name="task">
+  <li>{{text}}</li>
 </template>
diff --git a/simple-todos.js b/simple-todos.js
index f8bee6b..871b655 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -1,23 +1,10 @@
 if (Meteor.isClient) {
-  // counter starts at 0
-  Session.setDefault("counter", 0);
-
-  Template.hello.helpers({
-    counter: function () {
-      return Session.get("counter");
-    }
-  });
-
-  Template.hello.events({
-    'click button': function () {
-      // increment the counter when button is clicked
-      Session.set("counter", Session.get("counter") + 1);
-    }
-  });
-}
-
-if (Meteor.isServer) {
-  Meteor.startup(function () {
-    // code to run on server at startup
+  // This code only runs on the client
+  Template.body.helpers({
+    tasks: [
+      { text: "This is task 1" },
+      { text: "This is task 2" },
+      { text: "This is task 3" }
+    ]
   });
 }
-- 
2.2.1


From 519fa970161a46755765b3884c32f435252bc862 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:12:43 -0700
Subject: [PATCH 3/9] Step 3: Replace the static array with a Collection

---
 simple-todos.js | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/simple-todos.js b/simple-todos.js
index 871b655..69fdf2c 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -1,10 +1,10 @@
+Tasks = new Mongo.Collection("tasks");
+
 if (Meteor.isClient) {
   // This code only runs on the client
   Template.body.helpers({
-    tasks: [
-      { text: "This is task 1" },
-      { text: "This is task 2" },
-      { text: "This is task 3" }
-    ]
+    tasks: function () {
+      return Tasks.find({});
+    }
   });
 }
-- 
2.2.1


From 40eac55b0a6678d1560a8ff804871b0fae115a22 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:15:50 -0700
Subject: [PATCH 4/9] Step 4: A form to add tasks, sort to make newest tasks at
 the top

---
 simple-todos.html |  4 ++++
 simple-todos.js   | 21 ++++++++++++++++++++-
 2 files changed, 24 insertions(+), 1 deletion(-)

diff --git a/simple-todos.html b/simple-todos.html
index 95624e7..e31aef1 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -6,6 +6,10 @@
   <div class="container">
     <header>
       <h1>Todo List</h1>
+
+      <form class="new-task">
+        <input type="text" name="text" placeholder="Type to add new tasks" />
+      </form>
     </header>
 
     <ul>
diff --git a/simple-todos.js b/simple-todos.js
index 69fdf2c..ff4cc3a 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -4,7 +4,26 @@ if (Meteor.isClient) {
   // This code only runs on the client
   Template.body.helpers({
     tasks: function () {
-      return Tasks.find({});
+      // Show newest tasks first
+      return Tasks.find({}, {sort: {createdAt: -1}});
+    }
+  });
+
+  Template.body.events({
+    "submit .new-task": function (event) {
+      // This function is called when the new task form is submitted
+      var text = event.target.text.value;
+
+      Tasks.insert({
+        text: text,
+        createdAt: new Date() // current time
+      });
+
+      // Clear form
+      event.target.text.value = "";
+
+      // Prevent default form submit
+      return false;
     }
   });
 }
-- 
2.2.1


From ea5beb34103e48dbd58848de8455479f4061393e Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:17:14 -0700
Subject: [PATCH 5/9] Step 5: Make it possible to check off and delete tasks

---
 simple-todos.html |  8 +++++++-
 simple-todos.js   | 10 ++++++++++
 2 files changed, 17 insertions(+), 1 deletion(-)

diff --git a/simple-todos.html b/simple-todos.html
index e31aef1..94341cc 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -21,5 +21,11 @@
 </body>
 
 <template name="task">
-  <li>{{text}}</li>
+  <li class="{{#if checked}}checked{{/if}}">
+    <button class="delete">&times;</button>
+
+    <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
+
+    <span class="text">{{text}}</span>
+  </li>
 </template>
diff --git a/simple-todos.js b/simple-todos.js
index ff4cc3a..f71e52a 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -26,4 +26,14 @@ if (Meteor.isClient) {
       return false;
     }
   });
+
+  Template.task.events({
+    "click .toggle-checked": function () {
+      // Set the checked property to the opposite of its current value
+      Tasks.update(this._id, {$set: {checked: ! this.checked}});
+    },
+    "click .delete": function () {
+      Tasks.remove(this._id);
+    }
+  });
 }
-- 
2.2.1


From a89c298a25d532bd771ae6e6c35d8f579f837670 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:19:27 -0700
Subject: [PATCH 6/9] Step 8: Add option to hide completed tasks, show
 incomplete task count

---
 simple-todos.html |  7 ++++++-
 simple-todos.js   | 18 ++++++++++++++++--
 2 files changed, 22 insertions(+), 3 deletions(-)

diff --git a/simple-todos.html b/simple-todos.html
index 94341cc..7d7ca13 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -5,7 +5,12 @@
 <body>
   <div class="container">
     <header>
-      <h1>Todo List</h1>
+      <h1>Todo List ({{incompleteCount}})</h1>
+      
+      <label class="hide-completed">
+        <input type="checkbox" checked="{{hideCompleted}}" />
+        Hide Completed Tasks
+      </label>
 
       <form class="new-task">
         <input type="text" name="text" placeholder="Type to add new tasks" />
diff --git a/simple-todos.js b/simple-todos.js
index f71e52a..08e0426 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -4,8 +4,19 @@ if (Meteor.isClient) {
   // This code only runs on the client
   Template.body.helpers({
     tasks: function () {
-      // Show newest tasks first
-      return Tasks.find({}, {sort: {createdAt: -1}});
+      if (Session.get("hideCompleted")) {
+        // If hide completed is checked, filter tasks
+        return Tasks.find({checked: {$ne: true}}, {sort: {createdAt: -1}});
+      } else {
+        // Otherwise, return all of the tasks
+        return Tasks.find({}, {sort: {createdAt: -1}});
+      }
+    },
+    hideCompleted: function () {
+      return Session.get("hideCompleted");
+    },
+    incompleteCount: function () {
+      return Tasks.find({checked: {$ne: true}}).count();
     }
   });
 
@@ -24,6 +35,9 @@ if (Meteor.isClient) {
 
       // Prevent default form submit
       return false;
+    },
+    "change .hide-completed input": function (event) {
+      Session.set("hideCompleted", event.target.checked);
     }
   });
 
-- 
2.2.1


From 556826bbf72a3025e5afe00d79de98af4fff86c2 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:21:21 -0700
Subject: [PATCH 7/9] Step 9: Add users and login; display which user created a
 task

---
 .meteor/packages  |  3 +++
 .meteor/versions  | 11 +++++++++++
 simple-todos.html | 14 +++++++++-----
 simple-todos.js   |  8 +++++++-
 4 files changed, 30 insertions(+), 6 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index e893668..8866d7d 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -6,3 +6,6 @@
 meteor-platform
 autopublish
 insecure
+accounts-ui
+accounts-password
+
diff --git a/.meteor/versions b/.meteor/versions
index 8f169db..1fb53da 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,7 @@
+accounts-base@1.1.2
+accounts-password@1.0.3
+accounts-ui-unstyled@1.1.3
+accounts-ui@1.1.2
 application-configuration@1.0.3
 autopublish@1.0.1
 autoupdate@1.1.2
@@ -13,6 +17,7 @@ ctl@1.0.2
 ddp@1.0.10
 deps@1.0.5
 ejson@1.0.4
+email@1.0.4
 fastclick@1.0.1
 follower-livedata@1.0.2
 geojson-utils@1.0.1
@@ -23,7 +28,9 @@ id-map@1.0.1
 insecure@1.0.1
 jquery@1.0.1
 json@1.0.1
+less@1.0.10
 livedata@1.0.11
+localstorage@1.0.1
 logging@1.0.4
 meteor-platform@1.1.2
 meteor@1.1.2
@@ -31,6 +38,7 @@ minifiers@1.1.1
 minimongo@1.0.4
 mobile-status-bar@1.0.1
 mongo@1.0.7
+npm-bcrypt@0.7.7
 observe-sequence@1.0.3
 ordered-dict@1.0.1
 random@1.0.1
@@ -39,9 +47,12 @@ reactive-var@1.0.3
 reload@1.1.1
 retry@1.0.1
 routepolicy@1.0.2
+service-configuration@1.0.2
 session@1.0.3
+sha@1.0.1
 spacebars-compiler@1.0.3
 spacebars@1.0.3
+srp@1.0.1
 templating@1.0.8
 tracker@1.0.3
 ui@1.0.4
diff --git a/simple-todos.html b/simple-todos.html
index 7d7ca13..55c1dc9 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -6,15 +6,19 @@
   <div class="container">
     <header>
       <h1>Todo List ({{incompleteCount}})</h1>
-      
+
       <label class="hide-completed">
         <input type="checkbox" checked="{{hideCompleted}}" />
         Hide Completed Tasks
       </label>
 
-      <form class="new-task">
-        <input type="text" name="text" placeholder="Type to add new tasks" />
-      </form>
+      {{> loginButtons}}
+
+      {{#if currentUser}}
+        <form class="new-task">
+          <input type="text" name="text" placeholder="Type to add new tasks" />
+        </form>
+      {{/if}}
     </header>
 
     <ul>
@@ -31,6 +35,6 @@
 
     <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
 
-    <span class="text">{{text}}</span>
+    <span class="text"><strong>{{username}}</strong> - {{text}}</span>
   </li>
 </template>
diff --git a/simple-todos.js b/simple-todos.js
index 08e0426..a6e7d2a 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -27,7 +27,9 @@ if (Meteor.isClient) {
 
       Tasks.insert({
         text: text,
-        createdAt: new Date() // current time
+        createdAt: new Date(),            // current time
+        owner: Meteor.userId(),           // _id of logged in user
+        username: Meteor.user().username  // username of logged in user
       });
 
       // Clear form
@@ -50,4 +52,8 @@ if (Meteor.isClient) {
       Tasks.remove(this._id);
     }
   });
+
+  Accounts.ui.config({
+    passwordSignupFields: "USERNAME_ONLY"
+  });
 }
-- 
2.2.1


From 9a1a392a6e3ed81434c68114dc5f31e418bec308 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:22:53 -0700
Subject: [PATCH 8/9] Step 10: Move logic into Meteor.methods, remove insecure
 package

---
 .meteor/packages |  2 --
 .meteor/versions |  1 -
 simple-todos.js  | 33 +++++++++++++++++++++++++--------
 3 files changed, 25 insertions(+), 11 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 8866d7d..a87fb56 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -5,7 +5,5 @@
 
 meteor-platform
 autopublish
-insecure
 accounts-ui
 accounts-password
-
diff --git a/.meteor/versions b/.meteor/versions
index 1fb53da..05cbd87 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -25,7 +25,6 @@ html-tools@1.0.2
 htmljs@1.0.2
 http@1.0.7
 id-map@1.0.1
-insecure@1.0.1
 jquery@1.0.1
 json@1.0.1
 less@1.0.10
diff --git a/simple-todos.js b/simple-todos.js
index a6e7d2a..83daf06 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -25,12 +25,7 @@ if (Meteor.isClient) {
       // This function is called when the new task form is submitted
       var text = event.target.text.value;
 
-      Tasks.insert({
-        text: text,
-        createdAt: new Date(),            // current time
-        owner: Meteor.userId(),           // _id of logged in user
-        username: Meteor.user().username  // username of logged in user
-      });
+      Meteor.call("addTask", text);
 
       // Clear form
       event.target.text.value = "";
@@ -46,10 +41,10 @@ if (Meteor.isClient) {
   Template.task.events({
     "click .toggle-checked": function () {
       // Set the checked property to the opposite of its current value
-      Tasks.update(this._id, {$set: {checked: ! this.checked}});
+      Meteor.call("setChecked", this._id, ! this.checked);
     },
     "click .delete": function () {
-      Tasks.remove(this._id);
+      Meteor.call("deleteTask", this._id);
     }
   });
 
@@ -57,3 +52,25 @@ if (Meteor.isClient) {
     passwordSignupFields: "USERNAME_ONLY"
   });
 }
+
+Meteor.methods({
+  addTask: function (text) {
+    // Make sure the user is logged in before inserting a task
+    if (! Meteor.userId()) {
+      throw new Meteor.Error("not-authorized");
+    }
+
+    Tasks.insert({
+      text: text,
+      createdAt: new Date(),
+      owner: Meteor.userId(),
+      username: Meteor.user().username
+    });
+  },
+  deleteTask: function (taskId) {
+    Tasks.remove(taskId);
+  },
+  setChecked: function (taskId, setChecked) {
+    Tasks.update(taskId, { $set: { checked: setChecked} });
+  }
+});
-- 
2.2.1


From 10bdbc7434b913c85c156ae6e27fdbea4b2e27bb Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@mit.edu>
Date: Wed, 22 Oct 2014 11:25:59 -0700
Subject: [PATCH 9/9] Step 11: Add private task feature, remove the autopublish
 package

---
 .meteor/cordova-plugins |  1 +
 .meteor/packages        |  1 -
 .meteor/versions        |  1 -
 simple-todos.html       | 12 +++++++++++-
 simple-todos.js         | 45 +++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 57 insertions(+), 3 deletions(-)
 create mode 100644 .meteor/cordova-plugins

diff --git a/.meteor/cordova-plugins b/.meteor/cordova-plugins
new file mode 100644
index 0000000..8b13789
--- /dev/null
+++ b/.meteor/cordova-plugins
@@ -0,0 +1 @@
+
diff --git a/.meteor/packages b/.meteor/packages
index a87fb56..e293aea 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -4,6 +4,5 @@
 # but you can also edit it by hand.
 
 meteor-platform
-autopublish
 accounts-ui
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 05cbd87..2cf703f 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -3,7 +3,6 @@ accounts-password@1.0.3
 accounts-ui-unstyled@1.1.3
 accounts-ui@1.1.2
 application-configuration@1.0.3
-autopublish@1.0.1
 autoupdate@1.1.2
 base64@1.0.1
 binary-heap@1.0.1
diff --git a/simple-todos.html b/simple-todos.html
index 55c1dc9..0de883e 100644
--- a/simple-todos.html
+++ b/simple-todos.html
@@ -30,11 +30,21 @@
 </body>
 
 <template name="task">
-  <li class="{{#if checked}}checked{{/if}}">
+  <li class="{{#if checked}}checked{{/if}} {{#if private}}private{{/if}}">
     <button class="delete">&times;</button>
 
     <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
 
+    {{#if isOwner}}
+      <button class="toggle-private">
+        {{#if private}}
+          Private    
+        {{else}}
+          Public
+        {{/if}}
+      </button>
+    {{/if}}
+
     <span class="text"><strong>{{username}}</strong> - {{text}}</span>
   </li>
 </template>
diff --git a/simple-todos.js b/simple-todos.js
index 83daf06..43230d3 100644
--- a/simple-todos.js
+++ b/simple-todos.js
@@ -2,6 +2,8 @@ Tasks = new Mongo.Collection("tasks");
 
 if (Meteor.isClient) {
   // This code only runs on the client
+  Meteor.subscribe("tasks");
+
   Template.body.helpers({
     tasks: function () {
       if (Session.get("hideCompleted")) {
@@ -45,6 +47,15 @@ if (Meteor.isClient) {
     },
     "click .delete": function () {
       Meteor.call("deleteTask", this._id);
+    },
+    "click .toggle-private": function () {
+      Meteor.call("setPrivate", this._id, ! this.private);
+    }
+  });
+
+  Template.task.helpers({
+    isOwner: function () {
+      return this.owner === Meteor.userId();
     }
   });
 
@@ -68,9 +79,43 @@ Meteor.methods({
     });
   },
   deleteTask: function (taskId) {
+    var task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can delete it
+      throw new Meteor.Error("not-authorized");
+    }
+
     Tasks.remove(taskId);
   },
   setChecked: function (taskId, setChecked) {
+    var task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can check it off
+      throw new Meteor.Error("not-authorized");
+    }
+
     Tasks.update(taskId, { $set: { checked: setChecked} });
+  },
+  setPrivate: function (taskId, setToPrivate) {
+    var task = Tasks.findOne(taskId);
+
+    // Make sure only the task owner can make a task private
+    if (task.owner !== Meteor.userId()) {
+      throw new Meteor.Error("not-authorized");
+    }
+
+    Tasks.update(taskId, { $set: { private: setToPrivate } });
   }
 });
+
+if (Meteor.isServer) {
+  // Only publish tasks that are public or belong to the current user
+  Meteor.publish("tasks", function () {
+    return Tasks.find({
+      $or: [
+        { private: {$ne: true} },
+        { owner: this.userId }
+      ]
+    });
+  });
+}
-- 
2.2.1

