From 1d9c7079a2ffb10bff504c472b2175c1ed7bf1b2 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:05:51 -0700
Subject: [PATCH 01/46] Step 1: Run `meteor create`

---
 .gitignore                  |  1 +
 .meteor/.finished-upgraders | 13 +++++++++
 .meteor/.gitignore          |  1 +
 .meteor/.id                 |  7 +++++
 .meteor/packages            | 21 ++++++++++++++
 .meteor/platforms           |  2 ++
 .meteor/release             |  1 +
 .meteor/versions            | 69 +++++++++++++++++++++++++++++++++++++++++++++
 client/main.css             |  1 +
 client/main.html            | 25 ++++++++++++++++
 client/main.js              | 22 +++++++++++++++
 package.json                | 10 +++++++
 server/main.js              |  5 ++++
 13 files changed, 178 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 .meteor/.finished-upgraders
 create mode 100644 .meteor/.gitignore
 create mode 100644 .meteor/.id
 create mode 100644 .meteor/packages
 create mode 100644 .meteor/platforms
 create mode 100644 .meteor/release
 create mode 100644 .meteor/versions
 create mode 100644 client/main.css
 create mode 100644 client/main.html
 create mode 100644 client/main.js
 create mode 100644 package.json
 create mode 100644 server/main.js

diff --git a/.gitignore b/.gitignore
new file mode 100644
index 0000000..3c3629e
--- /dev/null
+++ b/.gitignore
@@ -0,0 +1 @@
+node_modules
diff --git a/.meteor/.finished-upgraders b/.meteor/.finished-upgraders
new file mode 100644
index 0000000..dacc2c0
--- /dev/null
+++ b/.meteor/.finished-upgraders
@@ -0,0 +1,13 @@
+# This file contains information which helps Meteor properly upgrade your
+# app when you run 'meteor update'. You should check it into version control
+# with your project.
+
+notices-for-0.9.0
+notices-for-0.9.1
+0.9.4-platform-file
+notices-for-facebook-graph-api-2
+1.2.0-standard-minifiers-package
+1.2.0-meteor-platform-split
+1.2.0-cordova-changes
+1.2.0-breaking-changes
+1.3.0-split-minifiers-package
diff --git a/.meteor/.gitignore b/.meteor/.gitignore
new file mode 100644
index 0000000..4083037
--- /dev/null
+++ b/.meteor/.gitignore
@@ -0,0 +1 @@
+local
diff --git a/.meteor/.id b/.meteor/.id
new file mode 100644
index 0000000..9a3be4f
--- /dev/null
+++ b/.meteor/.id
@@ -0,0 +1,7 @@
+# This file contains a token that is unique to your project.
+# Check it into your repository along with the rest of this directory.
+# It can be used for purposes such as:
+#   - ensuring you don't accidentally deploy one app on top of another
+#   - providing package authors with aggregated statistics
+
+1v2pn7n1jbklfu1hg4tnm
diff --git a/.meteor/packages b/.meteor/packages
new file mode 100644
index 0000000..d4c8001
--- /dev/null
+++ b/.meteor/packages
@@ -0,0 +1,21 @@
+# Meteor packages used by this project, one per line.
+# Check this file (and the other files in this directory) into your repository.
+#
+# 'meteor add' and 'meteor remove' will edit this file for you,
+# but you can also edit it by hand.
+
+meteor-base             # Packages every Meteor app needs to have
+mobile-experience       # Packages for a great mobile UX
+mongo                   # The database Meteor supports right now
+blaze-html-templates    # Compile .html files into Meteor Blaze views
+reactive-var            # Reactive variable for tracker
+jquery                  # Helpful client-side library
+tracker                 # Meteor's client-side reactive programming library
+
+standard-minifier-css   # CSS minifier run for production mode
+standard-minifier-js    # JS minifier run for production mode
+es5-shim                # ECMAScript 5 compatibility for older browsers.
+ecmascript              # Enable ECMAScript2015+ syntax in app code
+
+autopublish             # Publish all data to the clients (for prototyping)
+insecure                # Allow all DB writes from clients (for prototyping)
diff --git a/.meteor/platforms b/.meteor/platforms
new file mode 100644
index 0000000..efeba1b
--- /dev/null
+++ b/.meteor/platforms
@@ -0,0 +1,2 @@
+server
+browser
diff --git a/.meteor/release b/.meteor/release
new file mode 100644
index 0000000..ab70657
--- /dev/null
+++ b/.meteor/release
@@ -0,0 +1 @@
+METEOR@1.3-rc.2
diff --git a/.meteor/versions b/.meteor/versions
new file mode 100644
index 0000000..c3395d2
--- /dev/null
+++ b/.meteor/versions
@@ -0,0 +1,69 @@
+allow-deny@1.0.2-rc.2
+autopublish@1.0.5-rc.2
+autoupdate@1.2.6-rc.2
+babel-compiler@6.5.1-rc.2
+babel-runtime@0.1.6-rc.2
+base64@1.0.6-rc.2
+binary-heap@1.0.6-rc.2
+blaze@2.1.5-rc.2
+blaze-html-templates@1.0.2-rc.2
+blaze-tools@1.0.6-rc.2
+boilerplate-generator@1.0.6-rc.2
+caching-compiler@1.0.2-rc.2
+caching-html-compiler@1.0.4-rc.2
+callback-hook@1.0.6-rc.2
+check@1.1.2-rc.2
+ddp@1.2.3-rc.2
+ddp-client@1.2.3-rc.2
+ddp-common@1.2.3-rc.2
+ddp-server@1.2.4-rc.2
+deps@1.0.10-rc.2
+diff-sequence@1.0.3-rc.2
+ecmascript@0.4.1-rc.2
+ecmascript-runtime@0.2.8-rc.2
+ejson@1.0.9-rc.2
+es5-shim@4.5.8-rc.2
+fastclick@1.0.9-rc.2
+geojson-utils@1.0.6-rc.2
+hot-code-push@1.0.2-rc.2
+html-tools@1.0.7-rc.2
+htmljs@1.0.7-rc.2
+http@1.1.3-rc.2
+id-map@1.0.5-rc.2
+insecure@1.0.5-rc.2
+jquery@1.11.6-rc.2
+launch-screen@1.0.7-rc.2
+livedata@1.0.16-rc.2
+logging@1.0.10-rc.2
+meteor@1.1.12-rc.2
+meteor-base@1.0.2-rc.2
+minifier-css@1.1.9-rc.2
+minifier-js@1.1.9-rc.2
+minimongo@1.0.12-rc.2
+mobile-experience@1.0.2-rc.2
+mobile-status-bar@1.0.9-rc.2
+modules@0.5.1-rc.2
+modules-runtime@0.6.1-rc.2
+mongo@1.1.5-rc.2
+mongo-id@1.0.2-rc.2
+npm-mongo@1.4.41-rc.2
+observe-sequence@1.0.9-rc.2
+ordered-dict@1.0.5-rc.2
+promise@0.6.4-rc.2
+random@1.0.7-rc.2
+reactive-var@1.0.7-rc.2
+reload@1.1.6-rc.2
+retry@1.0.5-rc.2
+routepolicy@1.0.8-rc.2
+spacebars@1.0.9-rc.2
+spacebars-compiler@1.0.9-rc.2
+standard-minifier-css@1.0.4-rc.2
+standard-minifier-js@1.0.4-rc.2
+templating@1.1.7-rc.2
+templating-tools@1.0.2-rc.2
+tracker@1.0.11-rc.2
+ui@1.0.9-rc.2
+underscore@1.0.6-rc.2
+url@1.0.7-rc.2
+webapp@1.2.6-rc.2
+webapp-hashing@1.0.7-rc.2
diff --git a/client/main.css b/client/main.css
new file mode 100644
index 0000000..b6b4052
--- /dev/null
+++ b/client/main.css
@@ -0,0 +1 @@
+/* CSS declarations go here */
diff --git a/client/main.html b/client/main.html
new file mode 100644
index 0000000..6fe0dc5
--- /dev/null
+++ b/client/main.html
@@ -0,0 +1,25 @@
+<head>
+  <title>simple</title>
+</head>
+
+<body>
+  <h1>Welcome to Meteor!</h1>
+
+  {{> hello}}
+  {{> info}}
+</body>
+
+<template name="hello">
+  <button>Click Me</button>
+  <p>You've pressed the button {{counter}} times.</p>
+</template>
+
+<template name="info">
+  <h2>Learn Meteor!</h2>
+  <ul>
+    <li><a href="https://www.meteor.com/try">Do the Tutorial</a></li>
+    <li><a href="http://guide.meteor.com">Follow the Guide</a></li>
+    <li><a href="https://docs.meteor.com">Read the Docs</a></li>
+    <li><a href="https://forums.meteor.com">Discussions</a></li>
+  </ul>
+</template>
diff --git a/client/main.js b/client/main.js
new file mode 100644
index 0000000..ecb3282
--- /dev/null
+++ b/client/main.js
@@ -0,0 +1,22 @@
+import { Template } from 'meteor/templating';
+import { ReactiveVar } from 'meteor/reactive-var';
+
+import './main.html';
+
+Template.hello.onCreated(function helloOnCreated() {
+  // counter starts at 0
+  this.counter = new ReactiveVar(0);
+});
+
+Template.hello.helpers({
+  counter() {
+    return Template.instance().counter.get();
+  },
+});
+
+Template.hello.events({
+  'click button'(event, instance) {
+    // increment the counter when button is clicked
+    instance.counter.set(instance.counter.get() + 1);
+  },
+});
diff --git a/package.json b/package.json
new file mode 100644
index 0000000..4164b14
--- /dev/null
+++ b/package.json
@@ -0,0 +1,10 @@
+{
+  "name": "simple-todos",
+  "private": true,
+  "scripts": {
+    "start": "meteor run"
+  },
+  "dependencies": {
+    "meteor-node-stubs": "~0.2.0"
+  }
+}
diff --git a/server/main.js b/server/main.js
new file mode 100644
index 0000000..31a9e0e
--- /dev/null
+++ b/server/main.js
@@ -0,0 +1,5 @@
+import { Meteor } from 'meteor/meteor';
+
+Meteor.startup(() => {
+  // code to run on server at startup
+});
-- 
2.1.3


From 1bca6e0184b74c344463a577a01d7a3dbad1f8be Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:07:22 -0700
Subject: [PATCH 02/46] Step 2.1: Remove starter HTML code

---
 client/main.html | 22 ----------------------
 1 file changed, 22 deletions(-)

diff --git a/client/main.html b/client/main.html
index 6fe0dc5..7c48505 100644
--- a/client/main.html
+++ b/client/main.html
@@ -1,25 +1,3 @@
 <head>
   <title>simple</title>
 </head>
-
-<body>
-  <h1>Welcome to Meteor!</h1>
-
-  {{> hello}}
-  {{> info}}
-</body>
-
-<template name="hello">
-  <button>Click Me</button>
-  <p>You've pressed the button {{counter}} times.</p>
-</template>
-
-<template name="info">
-  <h2>Learn Meteor!</h2>
-  <ul>
-    <li><a href="https://www.meteor.com/try">Do the Tutorial</a></li>
-    <li><a href="http://guide.meteor.com">Follow the Guide</a></li>
-    <li><a href="https://docs.meteor.com">Read the Docs</a></li>
-    <li><a href="https://forums.meteor.com">Discussions</a></li>
-  </ul>
-</template>
-- 
2.1.3


From 07b752c2a16a711e2596f2167a66ef700f3e4d2c Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 13:11:52 +1100
Subject: [PATCH 03/46] Step 2.2: Replace starter HTML code

---
 imports/ui/body.html | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 imports/ui/body.html

diff --git a/imports/ui/body.html b/imports/ui/body.html
new file mode 100644
index 0000000..23a6507
--- /dev/null
+++ b/imports/ui/body.html
@@ -0,0 +1,17 @@
+<body>
+  <div class="container">
+    <header>
+      <h1>Todo List</h1>
+    </header>
+
+    <ul>
+      {{#each tasks}}
+        {{> task}}
+      {{/each}}
+    </ul>
+  </div>
+</body>
+
+<template name="task">
+  <li>{{text}}</li>
+</template>
-- 
2.1.3


From 7abbdb9a538a32b82c018df9ab9772cefdfb402b Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:07:50 -0700
Subject: [PATCH 04/46] Step 2.3: Replace starter JS code

---
 imports/ui/body.js | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 imports/ui/body.js

diff --git a/imports/ui/body.js b/imports/ui/body.js
new file mode 100644
index 0000000..3ad20b1
--- /dev/null
+++ b/imports/ui/body.js
@@ -0,0 +1,11 @@
+import { Template } from 'meteor/templating';
+
+import './body.html';
+
+Template.body.helpers({
+  tasks: [
+    { text: 'This is task 1' },
+    { text: 'This is task 2' },
+    { text: 'This is task 3' },
+  ],
+});
-- 
2.1.3


From f33c2b6553d6a5502605de8b044b1e448894322d Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:08:17 -0700
Subject: [PATCH 05/46] Step 2.4: Import starter JS

---
 client/main.js | 23 +----------------------
 1 file changed, 1 insertion(+), 22 deletions(-)

diff --git a/client/main.js b/client/main.js
index ecb3282..4e7c1a4 100644
--- a/client/main.js
+++ b/client/main.js
@@ -1,22 +1 @@
-import { Template } from 'meteor/templating';
-import { ReactiveVar } from 'meteor/reactive-var';
-
-import './main.html';
-
-Template.hello.onCreated(function helloOnCreated() {
-  // counter starts at 0
-  this.counter = new ReactiveVar(0);
-});
-
-Template.hello.helpers({
-  counter() {
-    return Template.instance().counter.get();
-  },
-});
-
-Template.hello.events({
-  'click button'(event, instance) {
-    // increment the counter when button is clicked
-    instance.counter.set(instance.counter.get() + 1);
-  },
-});
+import '../imports/ui/body.js';
-- 
2.1.3


From 39465319a937823b78df23fe36b1dd5a4bcd65c3 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:13:09 +1100
Subject: [PATCH 06/46] Step 2.5: Add CSS

---
 client/main.css | 125 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 125 insertions(+)

diff --git a/client/main.css b/client/main.css
index b6b4052..ed5e77e 100644
--- a/client/main.css
+++ b/client/main.css
@@ -1 +1,126 @@
 /* CSS declarations go here */
+body {
+  font-family: sans-serif;
+  background-color: #315481;
+  background-image: linear-gradient(to bottom, #315481, #918e82 100%);
+  background-attachment: fixed;
+
+  position: absolute;
+  top: 0;
+  bottom: 0;
+  left: 0;
+  right: 0;
+
+  padding: 0;
+  margin: 0;
+
+  font-size: 14px;
+}
+
+.container {
+  max-width: 600px;
+  margin: 0 auto;
+  min-height: 100%;
+  background: white;
+}
+
+header {
+  background: #d2edf4;
+  background-image: linear-gradient(to bottom, #d0edf5, #e1e5f0 100%);
+  padding: 20px 15px 15px 15px;
+  position: relative;
+}
+
+#login-buttons {
+  display: block;
+}
+
+h1 {
+  font-size: 1.5em;
+  margin: 0;
+  margin-bottom: 10px;
+  display: inline-block;
+  margin-right: 1em;
+}
+
+form {
+  margin-top: 10px;
+  margin-bottom: -10px;
+  position: relative;
+}
+
+.new-task input {
+  box-sizing: border-box;
+  padding: 10px 0;
+  background: transparent;
+  border: none;
+  width: 100%;
+  padding-right: 80px;
+  font-size: 1em;
+}
+
+.new-task input:focus{
+  outline: 0;
+}
+
+ul {
+  margin: 0;
+  padding: 0;
+  background: white;
+}
+
+.delete {
+  float: right;
+  font-weight: bold;
+  background: none;
+  font-size: 1em;
+  border: none;
+  position: relative;
+}
+
+li {
+  position: relative;
+  list-style: none;
+  padding: 15px;
+  border-bottom: #eee solid 1px;
+}
+
+li .text {
+  margin-left: 10px;
+}
+
+li.checked {
+  color: #888;
+}
+
+li.checked .text {
+  text-decoration: line-through;
+}
+
+li.private {
+  background: #eee;
+  border-color: #ddd;
+}
+
+header .hide-completed {
+  float: right;
+}
+
+.toggle-private {
+  margin-left: 5px;
+}
+
+@media (max-width: 600px) {
+  li {
+    padding: 12px 15px;
+  }
+
+  .search {
+    width: 150px;
+    clear: both;
+  }
+
+  .new-task input {
+    padding-bottom: 5px;
+  }
+}
-- 
2.1.3


From f7d73475384e80357eb9c7a5ca041d2546f60d62 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:15:47 +1100
Subject: [PATCH 07/46] Step 3.1: Create tasks collection

---
 imports/api/tasks.js | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 imports/api/tasks.js

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
new file mode 100644
index 0000000..a9ab038
--- /dev/null
+++ b/imports/api/tasks.js
@@ -0,0 +1,5 @@
+import { Mongo } from 'meteor/mongo';
+
+const Tasks = new Mongo.Collection('tasks');
+
+export { Tasks };
-- 
2.1.3


From ad62355a6a8ee24c21e37478504512596fe5201c Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:20:32 +1100
Subject: [PATCH 08/46] Step 3.2: Load tasks collection on the server

---
 server/main.js | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/server/main.js b/server/main.js
index 31a9e0e..ab941a4 100644
--- a/server/main.js
+++ b/server/main.js
@@ -1,5 +1 @@
-import { Meteor } from 'meteor/meteor';
-
-Meteor.startup(() => {
-  // code to run on server at startup
-});
+import '../imports/api/tasks.js';
-- 
2.1.3


From 6aff55c365b0b5507877d5a66dd62d3a65a38cb2 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:16:03 +1100
Subject: [PATCH 09/46] Step 3.3: Load tasks from Tasks collection

---
 imports/ui/body.js | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index 3ad20b1..fc36022 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -1,11 +1,11 @@
 import { Template } from 'meteor/templating';
 
+import { Tasks } from '../api/tasks.js';
+
 import './body.html';
 
 Template.body.helpers({
-  tasks: [
-    { text: 'This is task 1' },
-    { text: 'This is task 2' },
-    { text: 'This is task 3' },
-  ],
+  tasks() {
+    return Tasks.find({});
+  },
 });
-- 
2.1.3


From 9e387992b0911ef28958d5ec6d7380134da81c72 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:10:21 -0700
Subject: [PATCH 10/46] Step 4.1: Add form for new tasks

---
 imports/ui/body.html | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index 23a6507..0a1f952 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -2,6 +2,10 @@
   <div class="container">
     <header>
       <h1>Todo List</h1>
+
+      <form class="new-task">
+        <input type="text" name="text" placeholder="Type to add new tasks" />
+      </form>
     </header>
 
     <ul>
-- 
2.1.3


From c86ea9c4669be127531e6e3245841d2f76486fae Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:19:59 +1100
Subject: [PATCH 11/46] Step 4.2: Add event handler for form submit

---
 imports/ui/body.js | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index fc36022..42ad1d5 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -9,3 +9,23 @@ Template.body.helpers({
     return Tasks.find({});
   },
 });
+
+Template.body.events({
+  'submit .new-task'(event) {
+    // Prevent default browser form submit
+    event.preventDefault();
+
+    // Get value from form element
+    const target = event.target;
+    const text = target.text.value;
+
+    // Insert a task into the collection
+    Tasks.insert({
+      text,
+      createdAt: new Date(), // current time
+    });
+
+    // Clear form
+    target.text.value = '';
+  },
+});
-- 
2.1.3


From 28a7f6c41c48d3caf0b18e6dce1b32011b0b2f52 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:12:14 -0700
Subject: [PATCH 12/46] Step 4.3: Show newest tasks at the top

---
 imports/ui/body.js | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index 42ad1d5..6fbc9d5 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -6,7 +6,8 @@ import './body.html';
 
 Template.body.helpers({
   tasks() {
-    return Tasks.find({});
+    // Show newest tasks at the top
+    return Tasks.find({}, { sort: { createdAt: -1 } });
   },
 });
 
-- 
2.1.3


From 3588b089c96167bfed5239d14491a00580c43aea Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:12:57 -0700
Subject: [PATCH 13/46] Step 5.1: Add buttons to Task component

---
 imports/ui/task.html | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 imports/ui/task.html

diff --git a/imports/ui/task.html b/imports/ui/task.html
new file mode 100644
index 0000000..c4ab8e5
--- /dev/null
+++ b/imports/ui/task.html
@@ -0,0 +1,9 @@
+<template name="task">
+  <li class="{{#if checked}}checked{{/if}}">
+    <button class="delete">&times;</button>
+
+    <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
+
+    <span class="text">{{text}}</span>
+  </li>
+</template>
-- 
2.1.3


From 07235612b5bcbbaf82b8e453ee216878db2b1750 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:23:12 +1100
Subject: [PATCH 14/46] Step 5.2: Remove Tasks component from Body file

---
 imports/ui/body.html | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index 0a1f952..c40a87b 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -15,7 +15,3 @@
     </ul>
   </div>
 </body>
-
-<template name="task">
-  <li>{{text}}</li>
-</template>
-- 
2.1.3


From 1fd0a2c27aaaffac17a1ca533fac433c4f09f19e Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:26:44 +1100
Subject: [PATCH 15/46] Step 5.3: Add event handlers for Task buttons

---
 imports/ui/task.js | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 imports/ui/task.js

diff --git a/imports/ui/task.js b/imports/ui/task.js
new file mode 100644
index 0000000..782f932
--- /dev/null
+++ b/imports/ui/task.js
@@ -0,0 +1,17 @@
+import { Template } from 'meteor/templating';
+
+import { Tasks } from '../api/tasks.js';
+
+import './task.html';
+
+Template.task.events({
+  'click .toggle-checked'() {
+    // Set the checked property to the opposite of its current value
+    Tasks.update(this._id, {
+      $set: { checked: ! this.checked },
+    });
+  },
+  'click .delete'() {
+    Tasks.remove(this._id);
+  },
+});
-- 
2.1.3


From ad56ff1c15c42de7d18f15ca9cd49e38bc2301e1 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:26:57 +1100
Subject: [PATCH 16/46] Step 5.4: Import Task component from the body

---
 imports/ui/body.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index 6fbc9d5..bac22c6 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -2,6 +2,7 @@ import { Template } from 'meteor/templating';
 
 import { Tasks } from '../api/tasks.js';
 
+import './task.js';
 import './body.html';
 
 Template.body.helpers({
-- 
2.1.3


From de6ce06e8dc8b450598be076c0978ed948cc796a Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:24:18 -0700
Subject: [PATCH 17/46] Step 7.1: Add hide-completed checkbox to HTML

---
 imports/ui/body.html | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index c40a87b..a581239 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -3,6 +3,11 @@
     <header>
       <h1>Todo List</h1>
 
+      <label class="hide-completed">
+        <input type="checkbox" checked="{{hideCompleted}}" />
+        Hide Completed Tasks
+      </label>
+
       <form class="new-task">
         <input type="text" name="text" placeholder="Type to add new tasks" />
       </form>
-- 
2.1.3


From d7788574938a2b66e21ae6e04669e8ae89184e6d Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:33:00 +1100
Subject: [PATCH 18/46] Step 7.2: Add reactive-dict package

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index d4c8001..a113025 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -19,3 +19,4 @@ ecmascript              # Enable ECMAScript2015+ syntax in app code
 
 autopublish             # Publish all data to the clients (for prototyping)
 insecure                # Allow all DB writes from clients (for prototyping)
+reactive-dict
diff --git a/.meteor/versions b/.meteor/versions
index c3395d2..ccbd7bb 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -51,6 +51,7 @@ observe-sequence@1.0.9-rc.2
 ordered-dict@1.0.5-rc.2
 promise@0.6.4-rc.2
 random@1.0.7-rc.2
+reactive-dict@1.1.5-rc.2
 reactive-var@1.0.7-rc.2
 reload@1.1.6-rc.2
 retry@1.0.5-rc.2
-- 
2.1.3


From 0fdee1674646037fd9ce48d1b2b326472796b934 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:29:41 +1100
Subject: [PATCH 19/46] Step 7.3: Add state dictionary to the body

---
 imports/ui/body.js | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index bac22c6..d429b10 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -1,10 +1,15 @@
 import { Template } from 'meteor/templating';
+import { ReactiveDict } from 'meteor/reactive-dict';
 
 import { Tasks } from '../api/tasks.js';
 
 import './task.js';
 import './body.html';
 
+Template.body.onCreated(function bodyOnCreated() {
+  this.state = new ReactiveDict();
+});
+
 Template.body.helpers({
   tasks() {
     // Show newest tasks at the top
-- 
2.1.3


From 5a829eaf0add55a644414a18bce3dd680ff5426e Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:30:11 +1100
Subject: [PATCH 20/46] Step 7.4: Add event handler for checkbox

---
 imports/ui/body.js | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index d429b10..856dad4 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -35,4 +35,7 @@ Template.body.events({
     // Clear form
     target.text.value = '';
   },
+  'change .hide-completed input'(event, instance) {
+    instance.state.set('hideCompleted', event.target.checked);
+  },
 });
-- 
2.1.3


From 6acc630abe8ac8bef50a6abb5540c297e760bb53 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:31:16 +1100
Subject: [PATCH 21/46] Step 7.5: Add helpers to body template

---
 imports/ui/body.js | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index 856dad4..a207bf0 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -12,9 +12,18 @@ Template.body.onCreated(function bodyOnCreated() {
 
 Template.body.helpers({
   tasks() {
-    // Show newest tasks at the top
+    const instance = Template.instance();
+    if (instance.state.get('hideCompleted')) {
+      // If hide completed is checked, filter tasks
+      return Tasks.find({ checked: { $ne: true } }, { sort: { createdAt: -1 } });
+    }
+    // Otherwise, return all of the tasks
     return Tasks.find({}, { sort: { createdAt: -1 } });
   },
+  hideCompleted() {
+    const instance = Template.instance();
+    return instance.state.get('hideCompleted');
+  },
 });
 
 Template.body.events({
-- 
2.1.3


From d6c151918eedd35801c1d24f1584e68c0930445a Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:26:17 -0700
Subject: [PATCH 22/46] Step 7.6: Add incompleteCount helper to body

---
 imports/ui/body.js | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index a207bf0..f25871e 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -24,6 +24,9 @@ Template.body.helpers({
     const instance = Template.instance();
     return instance.state.get('hideCompleted');
   },
+  incompleteCount() {
+    return Tasks.find({ checked: { $ne: true } }).count();
+  },
 });
 
 Template.body.events({
-- 
2.1.3


From 2fca40720ee52fa8ce8379ff7ea5135eaf04a010 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:26:37 -0700
Subject: [PATCH 23/46] Step 7.7: Display incompleteCount

---
 imports/ui/body.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index a581239..a734c03 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -1,7 +1,7 @@
 <body>
   <div class="container">
     <header>
-      <h1>Todo List</h1>
+      <h1>Todo List ({{incompleteCount}})</h1>
 
       <label class="hide-completed">
         <input type="checkbox" checked="{{hideCompleted}}" />
-- 
2.1.3


From e7a71591be2d788d098e02fe4142eef79078fc19 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:27:03 -0700
Subject: [PATCH 24/46] Step 8.1: Add accounts-ui and accounts-password

---
 .meteor/packages |  2 ++
 .meteor/versions | 14 ++++++++++++++
 2 files changed, 16 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index a113025..5c68b39 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -20,3 +20,5 @@ ecmascript              # Enable ECMAScript2015+ syntax in app code
 autopublish             # Publish all data to the clients (for prototyping)
 insecure                # Allow all DB writes from clients (for prototyping)
 reactive-dict
+accounts-ui
+accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index ccbd7bb..b739407 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,7 @@
+accounts-base@1.2.4-rc.2
+accounts-password@1.1.6-rc.2
+accounts-ui@1.1.7-rc.2
+accounts-ui-unstyled@1.1.10-rc.2
 allow-deny@1.0.2-rc.2
 autopublish@1.0.5-rc.2
 autoupdate@1.2.6-rc.2
@@ -16,12 +20,14 @@ check@1.1.2-rc.2
 ddp@1.2.3-rc.2
 ddp-client@1.2.3-rc.2
 ddp-common@1.2.3-rc.2
+ddp-rate-limiter@1.0.2-rc.2
 ddp-server@1.2.4-rc.2
 deps@1.0.10-rc.2
 diff-sequence@1.0.3-rc.2
 ecmascript@0.4.1-rc.2
 ecmascript-runtime@0.2.8-rc.2
 ejson@1.0.9-rc.2
+email@1.0.10-rc.2
 es5-shim@4.5.8-rc.2
 fastclick@1.0.9-rc.2
 geojson-utils@1.0.6-rc.2
@@ -33,7 +39,9 @@ id-map@1.0.5-rc.2
 insecure@1.0.5-rc.2
 jquery@1.11.6-rc.2
 launch-screen@1.0.7-rc.2
+less@2.5.5-rc.2
 livedata@1.0.16-rc.2
+localstorage@1.0.7-rc.2
 logging@1.0.10-rc.2
 meteor@1.1.12-rc.2
 meteor-base@1.0.2-rc.2
@@ -46,18 +54,24 @@ modules@0.5.1-rc.2
 modules-runtime@0.6.1-rc.2
 mongo@1.1.5-rc.2
 mongo-id@1.0.2-rc.2
+npm-bcrypt@0.7.8_2
 npm-mongo@1.4.41-rc.2
 observe-sequence@1.0.9-rc.2
 ordered-dict@1.0.5-rc.2
 promise@0.6.4-rc.2
 random@1.0.7-rc.2
+rate-limit@1.0.2-rc.2
 reactive-dict@1.1.5-rc.2
 reactive-var@1.0.7-rc.2
 reload@1.1.6-rc.2
 retry@1.0.5-rc.2
 routepolicy@1.0.8-rc.2
+service-configuration@1.0.7-rc.2
+session@1.1.3-rc.2
+sha@1.0.5-rc.2
 spacebars@1.0.9-rc.2
 spacebars-compiler@1.0.9-rc.2
+srp@1.0.6-rc.2
 standard-minifier-css@1.0.4-rc.2
 standard-minifier-js@1.0.4-rc.2
 templating@1.1.7-rc.2
-- 
2.1.3


From 58bc4b455dae5d3e7ed27fc692eae44b16a77bb3 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:27:23 -0700
Subject: [PATCH 25/46] Step 8.2: Include loginButtons

---
 imports/ui/body.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index a734c03..353a82c 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -8,6 +8,8 @@
         Hide Completed Tasks
       </label>
 
+      {{> loginButtons}}
+
       <form class="new-task">
         <input type="text" name="text" placeholder="Type to add new tasks" />
       </form>
-- 
2.1.3


From 99d87f8e3bcdd2ef6f8cb96d3971e09a66f344a1 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:36:02 +1100
Subject: [PATCH 26/46] Step 8.3: Configure accounts-ui

---
 imports/startup/accounts-config.js | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 imports/startup/accounts-config.js

diff --git a/imports/startup/accounts-config.js b/imports/startup/accounts-config.js
new file mode 100644
index 0000000..7e4f7e5
--- /dev/null
+++ b/imports/startup/accounts-config.js
@@ -0,0 +1,5 @@
+import { Accounts } from 'meteor/accounts-base';
+
+Accounts.ui.config({
+  passwordSignupFields: 'USERNAME_ONLY',
+});
-- 
2.1.3


From bac951b21ef76b2d815ba4c9a432c638230a8af4 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:36:36 +1100
Subject: [PATCH 27/46] Step 8.4: Import accounts configuration

---
 client/main.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/main.js b/client/main.js
index 4e7c1a4..739c50f 100644
--- a/client/main.js
+++ b/client/main.js
@@ -1 +1,2 @@
+import '../imports/startup/accounts-config.js';
 import '../imports/ui/body.js';
-- 
2.1.3


From 5d36f08b552dba72dbbc8cfba6ddc5e1af7e9b92 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:28:24 -0700
Subject: [PATCH 28/46] Step 8.5: Update insert to include user data

---
 imports/ui/body.js | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index f25871e..15a3c8e 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -1,3 +1,4 @@
+import { Meteor } from 'meteor/meteor';
 import { Template } from 'meteor/templating';
 import { ReactiveDict } from 'meteor/reactive-dict';
 
@@ -42,6 +43,8 @@ Template.body.events({
     Tasks.insert({
       text,
       createdAt: new Date(), // current time
+      owner: Meteor.userId(),
+      username: Meteor.user().username,
     });
 
     // Clear form
-- 
2.1.3


From 826537bc83e8ac442b2bdb1898b7fba688cfe877 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:28:47 -0700
Subject: [PATCH 29/46] Step 8.6: Only show add task form if logged in

---
 imports/ui/body.html | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/imports/ui/body.html b/imports/ui/body.html
index 353a82c..6cd1dba 100644
--- a/imports/ui/body.html
+++ b/imports/ui/body.html
@@ -10,9 +10,11 @@
 
       {{> loginButtons}}
 
-      <form class="new-task">
-        <input type="text" name="text" placeholder="Type to add new tasks" />
-      </form>
+      {{#if currentUser}}
+        <form class="new-task">
+          <input type="text" name="text" placeholder="Type to add new tasks" />
+        </form>
+      {{/if}}
     </header>
 
     <ul>
-- 
2.1.3


From 0958888adeb5999647cebe5c4d9239a8be834a6f Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:29:11 -0700
Subject: [PATCH 30/46] Step 8.7: Display username next to task

---
 imports/ui/task.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/imports/ui/task.html b/imports/ui/task.html
index c4ab8e5..c42e8fc 100644
--- a/imports/ui/task.html
+++ b/imports/ui/task.html
@@ -4,6 +4,6 @@
 
     <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
 
-    <span class="text">{{text}}</span>
+    <span class="text"><strong>{{username}}</strong> - {{text}}</span>
   </li>
 </template>
-- 
2.1.3


From 8f0bedc7c5f6874486b5b2717e33abe60e59e0bb Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:29:52 -0700
Subject: [PATCH 31/46] Step 9.1: Remove insecure package

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 5c68b39..d4578d9 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,7 +18,6 @@ es5-shim                # ECMAScript 5 compatibility for older browsers.
 ecmascript              # Enable ECMAScript2015+ syntax in app code
 
 autopublish             # Publish all data to the clients (for prototyping)
-insecure                # Allow all DB writes from clients (for prototyping)
 reactive-dict
 accounts-ui
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index b739407..3d9bd1e 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -36,7 +36,6 @@ html-tools@1.0.7-rc.2
 htmljs@1.0.7-rc.2
 http@1.1.3-rc.2
 id-map@1.0.5-rc.2
-insecure@1.0.5-rc.2
 jquery@1.11.6-rc.2
 launch-screen@1.0.7-rc.2
 less@2.5.5-rc.2
-- 
2.1.3


From aa81d23d23aef1bc3f7a1be5331be354b2a2bc7e Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:30:20 -0700
Subject: [PATCH 32/46] Step 9.2: Define some methods

---
 imports/api/tasks.js | 31 +++++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
index a9ab038..30194c5 100644
--- a/imports/api/tasks.js
+++ b/imports/api/tasks.js
@@ -1,5 +1,36 @@
+import { Meteor } from 'meteor/meteor';
 import { Mongo } from 'meteor/mongo';
+import { check } from 'meteor/check';
 
 const Tasks = new Mongo.Collection('tasks');
 
+Meteor.methods({
+  'tasks.insert'(text) {
+    check(text, String);
+
+    // Make sure the user is logged in before inserting a task
+    if (! Meteor.userId()) {
+      throw new Meteor.Error('not-authorized');
+    }
+
+    Tasks.insert({
+      text,
+      createdAt: new Date(),
+      owner: Meteor.userId(),
+      username: Meteor.user().username,
+    });
+  },
+  'tasks.remove'(taskId) {
+    check(taskId, String);
+
+    Tasks.remove(taskId);
+  },
+  'tasks.setChecked'(taskId, setChecked) {
+    check(taskId, String);
+    check(setChecked, Boolean);
+
+    Tasks.update(taskId, { $set: { checked: setChecked } });
+  },
+});
+
 export { Tasks };
-- 
2.1.3


From 6a9e4a34311cc0949b0d0310884781009287a6ce Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:31:24 -0700
Subject: [PATCH 33/46] Step 9.3: Replace insert with addTask method

---
 imports/ui/body.js | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index 15a3c8e..d83eaca 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -40,12 +40,7 @@ Template.body.events({
     const text = target.text.value;
 
     // Insert a task into the collection
-    Tasks.insert({
-      text,
-      createdAt: new Date(), // current time
-      owner: Meteor.userId(),
-      username: Meteor.user().username,
-    });
+    Meteor.call('tasks.insert', text);
 
     // Clear form
     target.text.value = '';
-- 
2.1.3


From 22369c263971a1308c0e48503f30f6239cfab59f Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:31:46 -0700
Subject: [PATCH 34/46] Step 9.4: Replace update and remove with methods

---
 imports/ui/task.js | 9 +++------
 1 file changed, 3 insertions(+), 6 deletions(-)

diff --git a/imports/ui/task.js b/imports/ui/task.js
index 782f932..3775ceb 100644
--- a/imports/ui/task.js
+++ b/imports/ui/task.js
@@ -1,17 +1,14 @@
+import { Meteor } from 'meteor/meteor';
 import { Template } from 'meteor/templating';
 
-import { Tasks } from '../api/tasks.js';
-
 import './task.html';
 
 Template.task.events({
   'click .toggle-checked'() {
     // Set the checked property to the opposite of its current value
-    Tasks.update(this._id, {
-      $set: { checked: ! this.checked },
-    });
+    Meteor.call('tasks.setChecked', this._id, !this.checked);
   },
   'click .delete'() {
-    Tasks.remove(this._id);
+    Meteor.call('tasks.remove', this._id);
   },
 });
-- 
2.1.3


From 7632ca1dc2e711e6b356c75e85398e72eeb7d636 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:32:19 -0700
Subject: [PATCH 35/46] Step 10.1: Remove autopublish

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index d4578d9..3ecf3a1 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -17,7 +17,6 @@ standard-minifier-js    # JS minifier run for production mode
 es5-shim                # ECMAScript 5 compatibility for older browsers.
 ecmascript              # Enable ECMAScript2015+ syntax in app code
 
-autopublish             # Publish all data to the clients (for prototyping)
 reactive-dict
 accounts-ui
 accounts-password
diff --git a/.meteor/versions b/.meteor/versions
index 3d9bd1e..4f59e62 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -3,7 +3,6 @@ accounts-password@1.1.6-rc.2
 accounts-ui@1.1.7-rc.2
 accounts-ui-unstyled@1.1.10-rc.2
 allow-deny@1.0.2-rc.2
-autopublish@1.0.5-rc.2
 autoupdate@1.2.6-rc.2
 babel-compiler@6.5.1-rc.2
 babel-runtime@0.1.6-rc.2
-- 
2.1.3


From 1394681f2ba706a654785b75bc4cd21f72725d69 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:45:32 +1100
Subject: [PATCH 36/46] Step 10.2: Add publication for tasks

---
 imports/api/tasks.js | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
index 30194c5..c048739 100644
--- a/imports/api/tasks.js
+++ b/imports/api/tasks.js
@@ -4,6 +4,13 @@ import { check } from 'meteor/check';
 
 const Tasks = new Mongo.Collection('tasks');
 
+if (Meteor.isServer) {
+  // This code only runs on the server
+  Meteor.publish('tasks', function tasksPublication() {
+    return Tasks.find();
+  });
+}
+
 Meteor.methods({
   'tasks.insert'(text) {
     check(text, String);
-- 
2.1.3


From f0d39217e0e172b9dc88fa4c50fa934cf78c9b91 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:45:58 +1100
Subject: [PATCH 37/46] Step 10.3: Subscribe to tasks

---
 imports/ui/body.js | 1 +
 1 file changed, 1 insertion(+)

diff --git a/imports/ui/body.js b/imports/ui/body.js
index d83eaca..59e5225 100644
--- a/imports/ui/body.js
+++ b/imports/ui/body.js
@@ -9,6 +9,7 @@ import './body.html';
 
 Template.body.onCreated(function bodyOnCreated() {
   this.state = new ReactiveDict();
+  Meteor.subscribe('tasks');
 });
 
 Template.body.helpers({
-- 
2.1.3


From 6943418ace2de7446f1254b472114c73d056e954 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:33:43 -0700
Subject: [PATCH 38/46] Step 10.4: Add private button

---
 imports/ui/task.html | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/imports/ui/task.html b/imports/ui/task.html
index c42e8fc..b9108ea 100644
--- a/imports/ui/task.html
+++ b/imports/ui/task.html
@@ -4,6 +4,16 @@
 
     <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
 
+    {{#if isOwner}}
+      <button class="toggle-private">
+        {{#if private}}
+          Private
+        {{else}}
+          Public
+        {{/if}}
+      </button>
+    {{/if}}
+
     <span class="text"><strong>{{username}}</strong> - {{text}}</span>
   </li>
 </template>
-- 
2.1.3


From 38e94dd493444eacf0bb3142e9ded86d4afc2455 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:34:13 -0700
Subject: [PATCH 39/46] Step 10.5: Add private class to private tasks

---
 imports/ui/task.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/imports/ui/task.html b/imports/ui/task.html
index b9108ea..218789f 100644
--- a/imports/ui/task.html
+++ b/imports/ui/task.html
@@ -1,5 +1,5 @@
 <template name="task">
-  <li class="{{#if checked}}checked{{/if}}">
+  <li class="{{#if checked}}checked{{/if}} {{#if private}}private{{/if}}">
     <button class="delete">&times;</button>
 
     <input type="checkbox" checked="{{checked}}" class="toggle-checked" />
-- 
2.1.3


From 671d4b124526ed7570f44ef318935cb53108f021 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:34:47 -0700
Subject: [PATCH 40/46] Step 10.6: Define helper to check ownership

---
 imports/ui/task.js | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/imports/ui/task.js b/imports/ui/task.js
index 3775ceb..af4bcf6 100644
--- a/imports/ui/task.js
+++ b/imports/ui/task.js
@@ -3,6 +3,12 @@ import { Template } from 'meteor/templating';
 
 import './task.html';
 
+Template.task.helpers({
+  isOwner() {
+    return this.owner === Meteor.userId();
+  },
+});
+
 Template.task.events({
   'click .toggle-checked'() {
     // Set the checked property to the opposite of its current value
-- 
2.1.3


From 915efc0ffae6ac361db95a6dfb0e327042d89c3e Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:35:31 -0700
Subject: [PATCH 41/46] Step 10.7: Define method to set tasks to private

---
 imports/api/tasks.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
index c048739..1c3e891 100644
--- a/imports/api/tasks.js
+++ b/imports/api/tasks.js
@@ -38,6 +38,19 @@ Meteor.methods({
 
     Tasks.update(taskId, { $set: { checked: setChecked } });
   },
+  'tasks.setPrivate'(taskId, setToPrivate) {
+    check(taskId, String);
+    check(setToPrivate, Boolean);
+
+    const task = Tasks.findOne(taskId);
+
+    // Make sure only the task owner can make a task private
+    if (task.owner !== Meteor.userId()) {
+      throw new Meteor.Error('not-authorized');
+    }
+
+    Tasks.update(taskId, { $set: { private: setToPrivate } });
+  },
 });
 
 export { Tasks };
-- 
2.1.3


From 12fc5a9ffcd73fba07a2d954c1e9d90bdd5c8c13 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:35:55 -0700
Subject: [PATCH 42/46] Step 10.8: Add event handler to call the setPrivate
 method

---
 imports/ui/task.js | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/imports/ui/task.js b/imports/ui/task.js
index af4bcf6..6b51496 100644
--- a/imports/ui/task.js
+++ b/imports/ui/task.js
@@ -17,4 +17,7 @@ Template.task.events({
   'click .delete'() {
     Meteor.call('tasks.remove', this._id);
   },
+  'click .toggle-private'() {
+    Meteor.call('tasks.setPrivate', this._id, !this.private);
+  },
 });
-- 
2.1.3


From e26fa2b01321672c241a1b168a8fe8f975dcab38 Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:36:38 -0700
Subject: [PATCH 43/46] Step 10.9: Only publish tasks the user is allowed to
 see

---
 imports/api/tasks.js | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
index 1c3e891..afbcb81 100644
--- a/imports/api/tasks.js
+++ b/imports/api/tasks.js
@@ -6,8 +6,14 @@ const Tasks = new Mongo.Collection('tasks');
 
 if (Meteor.isServer) {
   // This code only runs on the server
+  // Only publish tasks that are public or belong to the current user
   Meteor.publish('tasks', function tasksPublication() {
-    return Tasks.find();
+    return Tasks.find({
+      $or: [
+        { private: { $ne: true } },
+        { owner: this.userId },
+      ],
+    });
   });
 }
 
-- 
2.1.3


From 1214baf6ab1ded4093e239bcd688cb9ed7234f9a Mon Sep 17 00:00:00 2001
From: Sashko Stubailo <sashko@stubailo.com>
Date: Tue, 14 Jul 2015 19:37:36 -0700
Subject: [PATCH 44/46] Step 10.10: Add some extra security to methods

---
 imports/api/tasks.js | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/imports/api/tasks.js b/imports/api/tasks.js
index afbcb81..222dd81 100644
--- a/imports/api/tasks.js
+++ b/imports/api/tasks.js
@@ -26,6 +26,7 @@ Meteor.methods({
       throw new Meteor.Error('not-authorized');
     }
 
+
     Tasks.insert({
       text,
       createdAt: new Date(),
@@ -36,12 +37,24 @@ Meteor.methods({
   'tasks.remove'(taskId) {
     check(taskId, String);
 
+    const task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can delete it
+      throw new Meteor.Error('not-authorized');
+    }
+
     Tasks.remove(taskId);
   },
   'tasks.setChecked'(taskId, setChecked) {
     check(taskId, String);
     check(setChecked, Boolean);
 
+    const task = Tasks.findOne(taskId);
+    if (task.private && task.owner !== Meteor.userId()) {
+      // If the task is private, make sure only the owner can check it off
+      throw new Meteor.Error('not-authorized');
+    }
+
     Tasks.update(taskId, { $set: { checked: setChecked } });
   },
   'tasks.setPrivate'(taskId, setToPrivate) {
-- 
2.1.3


From aee10beeee8932f432f25b4f4074238c3c8cab50 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:51:38 +1100
Subject: [PATCH 45/46] Step 11.1: Added practicalmeteor:mocha package

---
 .meteor/packages | 1 +
 .meteor/versions | 7 +++++++
 2 files changed, 8 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 3ecf3a1..6e6d2d4 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -20,3 +20,4 @@ ecmascript              # Enable ECMAScript2015+ syntax in app code
 reactive-dict
 accounts-ui
 accounts-password
+practicalmeteor:mocha@2.1.1-rc.1
diff --git a/.meteor/versions b/.meteor/versions
index 4f59e62..a03c196 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -16,6 +16,7 @@ caching-compiler@1.0.2-rc.2
 caching-html-compiler@1.0.4-rc.2
 callback-hook@1.0.6-rc.2
 check@1.1.2-rc.2
+coffeescript@1.0.15-rc.2
 ddp@1.2.3-rc.2
 ddp-client@1.2.3-rc.2
 ddp-common@1.2.3-rc.2
@@ -56,6 +57,11 @@ npm-bcrypt@0.7.8_2
 npm-mongo@1.4.41-rc.2
 observe-sequence@1.0.9-rc.2
 ordered-dict@1.0.5-rc.2
+practicalmeteor:chai@2.1.0_1
+practicalmeteor:loglevel@1.2.0_2
+practicalmeteor:mocha@2.1.1-rc.1
+practicalmeteor:mocha-core@0.1.4
+practicalmeteor:sinon@1.14.1_2
 promise@0.6.4-rc.2
 random@1.0.7-rc.2
 rate-limit@1.0.2-rc.2
@@ -74,6 +80,7 @@ standard-minifier-css@1.0.4-rc.2
 standard-minifier-js@1.0.4-rc.2
 templating@1.1.7-rc.2
 templating-tools@1.0.2-rc.2
+tmeasday:test-reporter-helpers@0.2.1
 tracker@1.0.11-rc.2
 ui@1.0.9-rc.2
 underscore@1.0.6-rc.2
-- 
2.1.3


From cf019568a922750076a3e9b5297bb689231744c6 Mon Sep 17 00:00:00 2001
From: Tom Coleman <tom@thesnail.org>
Date: Thu, 17 Mar 2016 12:52:51 +1100
Subject: [PATCH 46/46] Step 11.2: Added a simple method test

---
 imports/api/tasks.tests.js | 36 ++++++++++++++++++++++++++++++++++++
 1 file changed, 36 insertions(+)
 create mode 100644 imports/api/tasks.tests.js

diff --git a/imports/api/tasks.tests.js b/imports/api/tasks.tests.js
new file mode 100644
index 0000000..212a91d
--- /dev/null
+++ b/imports/api/tasks.tests.js
@@ -0,0 +1,36 @@
+/* eslint-env mocha */
+
+import { Meteor } from 'meteor/meteor';
+import { Random } from 'meteor/random';
+import { assert } from 'meteor/practicalmeteor:chai';
+
+import { Tasks } from './tasks.js';
+
+if (Meteor.isServer) {
+  describe('Tasks', () => {
+    describe('methods', () => {
+      const userId = Random.id();
+      let taskId;
+
+      beforeEach(() => {
+        Tasks.remove({});
+        taskId = Tasks.insert({
+          text: 'test task',
+          createdAt: new Date(),
+          owner: userId,
+          username: 'tmeasday',
+        });
+      });
+
+      it('can delete owned task', () => {
+        const deleteTask = Meteor.server.method_handlers['tasks.remove'];
+
+        // Call delete task with a faked user context, so the server thinks we have userId
+        const invocation = { userId };
+        deleteTask.apply(invocation, [taskId]);
+
+        assert.equal(Tasks.find().count(), 0);
+      });
+    });
+  });
+}
-- 
2.1.3

